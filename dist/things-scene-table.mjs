import{Layout as n,Model as t,Container as e,Component as o,RectPath as r,HTMLOverlayContainer as s}from"@hatiolab/things-scene";import{html as i,css as c,LitElement as u}from"lit-element";function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function a(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function h(n,t,e){return t&&a(n.prototype,t),e&&a(n,e),n}function p(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&m(n,t)}function f(n){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function m(n,t){return(m=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function d(n,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n):t}function g(n,t){return t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}}))}var w={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"select",label:"data-spread-to",name:"spreadTo",property:{options:["text","data"]}}],"value-property":"data"},v={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},y={strokeStyle:"",lineDash:"solid",lineWidth:0},C={strokeStyle:"#999",lineDash:"solid",lineWidth:1},b=n.get("table");function x(n){return t.compile({type:"table-cell",strokeStyle:"blue",left:0,top:0,width:1,height:1,textWrap:!0,border:E(C,"all")},n)}function k(n,e){var o=JSON.parse(JSON.stringify(n));return delete o.text,t.compile(o,e)}function E(n,t){return(v[t]||[]).reduce(function(t,e){return t[e]=n,t},{})}function R(n,t,e){n&&n.set("border",Object.assign({},n.get("border")||{},E(t,e)))}function O(n,t,e,o){return 0==o||!(o%t)||-1==e.indexOf(o-1)}function M(n,t,e,o){return o==n-1||o%t==t-1||-1==e.indexOf(o+1)}function _(n,t,e,o){return o<t||-1==e.indexOf(o-t)}function B(n,t,e,o){return o>n-t-1||-1==e.indexOf(o+t)}function A(n,t){return t-n}function j(n,t){return t+n}function P(n,t){return t%n?t-1:-1}function S(n,t){return(t+1)%n?t+1:-1}function z(n,t){for(var e=[],o=0;o<t;o++)e.push(1);return e}var D={ondragmove:function(n,t,e){var o=e.textBounds,r=o.left,s=(o.top,o.width),i=(o.height,e.widths_sum),c=e.widths.slice(),u=r+c.slice(0,t+1).reduce(function(n,t){return n+t},0)/i*s,l=(e.transcoordP2S(n.x,n.y).x-u)/s*i,a=i/s*10;l=l<0?-Math.min(c[t]-a,-l):Math.min(c[t+1]-a,l),c[t]=Math.round(100*(c[t]+l))/100,c[t+1]=Math.round(100*(c[t+1]-l))/100,e.set("widths",c)}},T={ondragmove:function(n,t,e){var o=e.textBounds,r=(o.left,o.top),s=(o.width,o.height),i=e.heights_sum,c=e.heights.slice();t-=e.columns-1;var u=r+c.slice(0,t+1).reduce(function(n,t){return n+t},0)/i*s,l=(e.transcoordP2S(n.x,n.y).y-u)/s*i,a=i/s*10;l=l<0?-Math.min(c[t]-a,-l):Math.min(c[t+1]-a,l),c[t]=Math.round(100*(c[t]+l))/100,c[t+1]=Math.round(100*(c[t+1]-l))/100,e.set("heights",c)}},N=function(n){function t(){return l(this,t),d(this,f(t).apply(this,arguments))}return p(t,e),h(t,[{key:"created",value:function(){var n=this.rows*this.columns,t=this.size()-n;if(0!=t){if(t>0){var e=this._components.slice(t);this.remove(e)}else{for(var o=[],r=0;r<-t;r++)o.push(x(this.app));this.add(o)}var s=this.get("widths"),i=this.get("heights");(!s||s.length<this.columns)&&this.set("widths",this.widths),(!i||i.length<this.rows)&&this.set("heights",this.heights)}}},{key:"buildCells",value:function(n,t,e,o){var r=this;if(n<e){var s=this._components.slice(o*n),i=[];if(s.forEach(function(n){(!0===n.merged||n.rowspan>1||n.colspan>1)&&i.push(n)}),i.length>0){var c=[],u=[];i.forEach(function(n){var t,e,s;for(t=r.components.indexOf(n)%o,s=(e=Math.floor(r.components.indexOf(n)/o))*o+t+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var l=r.components.indexOf(i)%o,a=r.components.indexOf(i)%o+i.colspan,h=Math.floor(r.components.indexOf(i)/o),p=Math.floor(r.components.indexOf(i)/o)+i.rowspan;t>=l&&t<a&&e>=h&&e<p&&-1==u.indexOf(s)&&(u.push(s),c.push(i))}}}),c.forEach(function(t){t.rowspan-=e-n})}this.remove(s)}var l=Math.min(n,e);if(t>o)for(var a=0;a<l;a++)for(var h=o;h<t;h++)this.insertComponentAt(x(this.app),a*t+h);else if(t<o){for(var p=[],f=0;f<l;f++)for(var m=t;m<o;m++)p.push(this.components[f*o+m]);var d=[];if(p.forEach(function(n){(!0===n.merged||n.rowspan>1||n.colspan>1)&&d.push(n)}),d.length>0){var g=[],w=[];d.forEach(function(n){var t,e,s;for(t=r.components.indexOf(n)%o,s=(e=Math.floor(r.components.indexOf(n)/o))*o+t+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var c=r.components.indexOf(i)%o,u=r.components.indexOf(i)%o+i.colspan,l=Math.floor(r.components.indexOf(i)/o),a=Math.floor(r.components.indexOf(i)/o)+i.rowspan;t>=c&&t<u&&e>=l&&e<a&&-1==w.indexOf(s)&&(w.push(s),g.push(i))}}}),g.forEach(function(n){n.colspan-=o-t})}this.remove(p)}if(n>e){for(var v=[],y=e;y<n;y++)for(var C=0;C<t;C++)v.push(x(this.app));this.add(v)}this.set({widths:this.widths,heights:this.heights})}},{key:"setCellsStyle",value:function(n,t,e){var o=this,r=this.components,s=r.length,i=this.get("columns"),c=[];n.forEach(function(n){if(c.push(n),n.colspan||n.rowspan)for(var t=o.getRowColumn(n).column,e=o.getRowColumn(n).row,r=e;r<e+n.rowspan;r++)for(var s=t;s<t+n.colspan;s++)r==e&&s==t||c.push(o.components[r*o.columns+s])});var u=c.map(function(n){return r.indexOf(n)});u.forEach(function(n){var o=r[n];switch(e){case"all":R(o,t,e),O(0,i,u,n)&&R(r[P(i,n)],t,"right"),M(s,i,u,n)&&R(r[S(i,n)],t,"left"),_(0,i,u,n)&&R(r[A(i,n)],t,"bottom"),B(s,i,u,n)&&R(r[j(i,n)],t,"top");break;case"in":O(0,i,u,n)||R(o,t,"left"),M(s,i,u,n)||R(o,t,"right"),_(0,i,u,n)||R(o,t,"top"),B(s,i,u,n)||R(o,t,"bottom");break;case"out":O(0,i,u,n)&&(R(o,t,"left"),R(r[P(i,n)],t,"right")),M(s,i,u,n)&&(R(o,t,"right"),R(r[S(i,n)],t,"left")),_(0,i,u,n)&&(R(o,t,"top"),R(r[A(i,n)],t,"bottom")),B(s,i,u,n)&&(R(o,t,"bottom"),R(r[j(i,n)],t,"top"));break;case"left":O(0,i,u,n)&&(R(o,t,"left"),R(r[P(i,n)],t,"right"));break;case"right":M(s,i,u,n)&&(R(o,t,"right"),R(r[S(i,n)],t,"left"));break;case"center":O(0,i,u,n)||R(o,t,"left"),M(s,i,u,n)||R(o,t,"right");break;case"middle":_(0,i,u,n)||R(o,t,"top"),B(s,i,u,n)||R(o,t,"bottom");break;case"top":_(0,i,u,n)&&(R(o,t,"top"),R(r[A(i,n)],t,"bottom"));break;case"bottom":B(s,i,u,n)&&(R(o,t,"bottom"),R(r[j(i,n)],t,"top"));break;case"clear":R(o,y,"all"),O(0,i,u,n)&&R(r[P(i,n)],y,"right"),M(s,i,u,n)&&R(r[S(i,n)],y,"left"),_(0,i,u,n)&&R(r[A(i,n)],y,"bottom"),B(s,i,u,n)&&R(r[j(i,n)],y,"top")}})}},{key:"setCellsData",value:function(){var n=this.data;if(n){n=this.toObjectArrayValue(n)||[];var t=this.components,e=this.state.spreadTo,o=void 0===e?"text":e;t.forEach(function(t){var e=t.model.dataKey,r=t.model.dataIndex;e&&r>=0&&(t[o]=(n[r]||{})[e])})}}},{key:"getRowColumn",value:function(n){var t=this.components.indexOf(n);this.components.length;return{column:t%this.columns,row:Math.floor(t/this.columns)}}},{key:"getCellsByRow",value:function(n){return this.components.slice(n*this.columns,(n+1)*this.columns)}},{key:"getCellsByColumn",value:function(n){for(var t=[],e=0;e<this.rows;e++)t.push(this.components[this.columns*e+n]);return t}},{key:"findMergedCellByX",value:function(n){for(var t,e=[],o=0;o<this.columns;o++)(!0===(t=this.components[n*this.columns+o]).merged||t.rowspan>1||t.colspan>1)&&e.push(t);return e}},{key:"findMergedCellByY",value:function(n){for(var t,e=[],o=0;o<this.rows;o++)(!0===(t=this.components[o*this.columns+n]).merged||t.rowspan>1||t.colspan>1)&&e.push(t);return e}},{key:"mergeCells",value:function(n){var t=this,e=[];if(n.forEach(function(n){var o=t.getRowColumn(n).row;-1==e.indexOf(o)&&e.push(o)}),e.length-1!=e[e.length-1]-e[0])return!1;var o=[];if(n.forEach(function(n){var e=t.getRowColumn(n).column;-1==o.indexOf(e)&&o.push(e)}),o.length-1!=o[o.length-1]-o[0])return!1;var r=e.length,s=o.length,i=n.length;if(i!==r*s||i<2)return!1;n.sort(function(n,e){return t.getRowColumn(n).row*t.columns+t.getRowColumn(n).column-(t.getRowColumn(e).row*t.columns+t.getRowColumn(e).column)});var c=n[0];c.set({colspan:s,rowspan:r});for(var u=1;u<i;u++)n[u].merged=!0;this.root.selected=[c]}},{key:"splitCells",value:function(n){this.getRowColumn(n[0]);for(var t=n[0],e=this.components.indexOf(n[0]),o=this.components.length,r=this.components[o-1],s=o/(this.getRowColumn(r).row+1),i=0;i<t.rowspan;i++)for(var c=void 0,u=e;u<e+t.colspan;u++)c=s*i+u,this.components[c].merged=!1;t.colspan=1,t.rowspan=1}},{key:"deleteRows",value:function(n){var t=this;if(1==n[0].merged)return!1;var e=[];n.forEach(function(n){var o=t.getRowColumn(n).row;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse();var o=this.heights.slice();e.forEach(function(n){var e=t.findMergedCellByX(n);if(0===e.length)t.remove(t.getCellsByRow(n));else{var o=[],r=[];e.forEach(function(n){var e,s,i;for(e=t.getRowColumn(n).column,i=(s=t.getRowColumn(n).row)*t.columns+e+1;i;){--i;var c=t.components[i];if(c.rowspan>1||c.colspan>1){var u=t.getRowColumn(c).column,l=t.getRowColumn(c).column+c.colspan,a=t.getRowColumn(c).row,h=t.getRowColumn(c).row+c.rowspan;e>=u&&e<l&&s>=a&&s<h&&-1==r.indexOf(i)&&(r.push(i),o.push(c))}}}),r.forEach(function(e){var o=Math.floor(e/t.columns);n===o&&o!==t.rows-1&&t.components[e].rowspan>1?(t.components[e+t.columns].rowspan=t.components[e].rowspan-1,t.components[e+t.columns].colspan=t.components[e].colspan,t.components[e+t.columns].merged=!1,t.components[e+t.columns].set("text",t.components[e].get("text"))):t.components[e].rowspan-=1}),t.remove(t.getCellsByRow(n))}}),o.splice(e,1),this.model.rows-=e.length,this.set("heights",o)}},{key:"deleteColumns",value:function(n){var t=this;if(1==n[0].merged)return!1;var e=[];n.forEach(function(n){var o=t.getRowColumn(n).column;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse(),e.forEach(function(n){var e=t.widths.slice(),o=t.findMergedCellByY(n);if(0===o.length)t.remove(t.getCellsByColumn(n));else{var r=[],s=[];o.forEach(function(n){var e,o,i;for(e=t.getRowColumn(n).column,i=(o=t.getRowColumn(n).row)*t.columns+e+1;i;){--i;var c=t.components[i];if(c.rowspan>1||c.colspan>1){var u=t.getRowColumn(c).column,l=t.getRowColumn(c).column+c.colspan,a=t.getRowColumn(c).row,h=t.getRowColumn(c).row+c.rowspan;e>=u&&e<l&&o>=a&&o<h&&-1==s.indexOf(i)&&(s.push(i),r.push(c))}}}),s.forEach(function(e){var o=e%t.columns;n===o&&o!==t.columns-1&&t.components[e].colspan>1?(t.components[e+1].rowspan=t.components[e].rowspan,t.components[e+1].colspan=t.components[e].colspan-1,t.components[e+1].merged=!1,t.components[e+1].set("text",t.components[e].get("text"))):t.components[e].colspan-=1}),t.remove(t.getCellsByColumn(n))}e.splice(n,1),t.model.columns-=1,t.set("widths",e)})}},{key:"insertCellsAbove",value:function(n){var t=this,e=[];if(n.forEach(function(n){var o=t.getRowColumn(n).row;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse(),e.length>=2)return!1;var o=e[0],r=[],s=[];e.forEach(function(n){var i=t.findMergedCellByX(n);if(0===i.length){for(var c=0;c<t.columns;c++)s.push(k(t.components[n*t.columns+c].model,t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)});var u=t.heights.slice();u.splice.apply(u,[o,0].concat(r)),t.set("heights",u),t.model.rows+=e.length,t.clearCache()}else{if(e.length>1)return!1;var l=[],a=[];i.forEach(function(n){var e,o,r;for(e=t.getRowColumn(n).column,r=(o=t.getRowColumn(n).row)*t.columns+e+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,u=t.getRowColumn(s).row,h=t.getRowColumn(s).row+s.rowspan;e>=i&&e<c&&o>=u&&o<h&&-1==a.indexOf(r)&&(a.push(r),l.push(s))}}}),a.forEach(function(i){if(a.length>=2)return!1;var c=Math.floor(i/t.columns),u={rowspan:t.components[i].rowspan,colspan:t.components[i].colspan,text:t.components[i].get("text"),merged:t.components[i].merged};if(c===n){for(var l=0;l<t.columns;l++)s.push(x(t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)}),t.components[i+t.columns].rowspan=u.rowspan,t.components[i+t.columns].colspan=u.colspan,t.components[i+t.columns].set("text",u.text),t.components[i+t.columns].merged=u.merged}else{for(var h=0;h<t.columns;h++)s.push(k(t.components[n*t.columns+h].model,t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)}),t.components[i].rowspan+=1}var p=t.heights.slice();p.splice.apply(p,[o,0].concat(r)),t.set("heights",p),t.model.rows+=e.length,t.clearCache()})}})}},{key:"insertCellsBelow",value:function(n){var t=this,e=[];if(n.forEach(function(n){var o=t.getRowColumn(n).row;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse(),e.length>=2)return!1;var o=e[e.length-1]+1,r=[],s=[];e.forEach(function(n){var e=t.findMergedCellByX(n);if(0===e.length){for(var i=0;i<t.columns;i++)s.push(k(t.components[n*t.columns+i].model,t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)});var c=t.heights.slice();c.splice.apply(c,[o,0].concat(r)),t.set("heights",c),t.model.rows+=1,t.clearCache()}else{var u=[],l=[];e.forEach(function(n){var e,o,r;for(e=t.getRowColumn(n).column,r=(o=t.getRowColumn(n).row)*t.columns+e+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,a=t.getRowColumn(s).row,h=t.getRowColumn(s).row+s.rowspan;e>=i&&e<c&&o>=a&&o<h&&-1==l.indexOf(r)&&(l.push(r),u.push(s))}}}),l.forEach(function(e){if(l.length>=2)return!1;var i=Math.floor(e/t.columns),c=t.components[e].rowspan;t.components[e].colspan,t.components[e].get("text"),t.components[e].merged;if(i+c-1===n){for(var u=0;u<t.columns;u++)s.push(x(t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)})}else if(i===n){for(var a=0;a<t.columns;a++)s.push(k(t.components[n*t.columns+a].model,t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)}),t.components[e].rowspan+=1,t.components[e+t.columns].rowspan=1,t.components[e+t.columns].colspan=1,t.components[e+t.columns].merged=!0,t.components[e+t.columns].set("text","")}else{for(var h=0;h<t.columns;h++)s.push(k(t.components[n*t.columns+h].model,t.app));r.push(t.heights[n]),s.reverse().forEach(function(n){t.insertComponentAt(n,o*t.columns)}),t.components[e].rowspan+=1}var p=t.heights.slice();p.splice.apply(p,[o,0].concat(r)),t.set("heights",p),t.model.rows+=1,t.clearCache()})}})}},{key:"insertCellsLeft",value:function(n){var t=this,e=[];if(n.forEach(function(n){var o=t.getRowColumn(n).column;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse(),e.length>=2)return!1;var o=e[0],r=[],s=[];e.forEach(function(n){var i=t.findMergedCellByY(n);if(0===i.length){for(var c=0;c<t.rows;c++)s.push(k(t.components[n+t.columns*c].model,t.app));r.push(t.widths[n]);var u=t.columns,l=t.rows;s.reverse().forEach(function(n){0==l&&(l=t.rows,u++),l--,t.insertComponentAt(n,o+l*u)});var a=t.widths.slice();t.model.columns+=e.length,a.splice.apply(a,[o,0].concat(r)),t.set("widths",a)}else{var h=[],p=[];i.forEach(function(n){var e,o,r;for(e=t.getRowColumn(n).column,r=(o=t.getRowColumn(n).row)*t.columns+e+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,u=t.getRowColumn(s).row,l=t.getRowColumn(s).row+s.rowspan;e>=i&&e<c&&o>=u&&o<l&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=i%t.columns;t.components[i].rowspan,t.components[i].colspan,t.components[i].get("text"),t.components[i].merged;if(c===n){for(var u=0;u<t.rows;u++)s.push(x(t.app));r.push(t.widths[n]);var l=t.columns,a=t.rows;s.reverse().forEach(function(n){0==a&&(a=t.rows,l++),a--,t.insertComponentAt(n,o+a*l)})}else{t.components[i].colspan+=1;for(var h=0;h<t.rows;h++)s.push(k(t.components[n+t.columns*h].model,t.app));r.push(t.widths[n]);var f=t.columns,m=t.rows;s.reverse().forEach(function(n){0==m&&(m=t.rows,f++),m--,t.insertComponentAt(n,o+m*f)})}var d=t.widths.slice();t.model.columns+=e.length,d.splice.apply(d,[o,0].concat(r)),t.set("widths",d)})}})}},{key:"insertCellsRight",value:function(n){var t=this,e=[];if(n.forEach(function(n){var o=t.getRowColumn(n).column;-1==e.indexOf(o)&&e.push(o)}),e.sort(function(n,t){return n-t}),e.reverse(),e.length>=2)return!1;var o=e[e.length-1]+1,r=[],s=[];e.forEach(function(n){var i=t.findMergedCellByY(n);if(0===i.length){for(var c=0;c<t.rows;c++)s.push(k(t.components[n+t.columns*c].model,t.app));r.push(t.widths[n]);var u=t.columns,l=t.rows;s.reverse().forEach(function(n){0==l&&(l=t.rows,u++),l--,t.insertComponentAt(n,o+l*u)});var a=t.widths.slice();t.model.columns+=e.length,a.splice.apply(a,[o,0].concat(r)),t.set("widths",a)}else{var h=[],p=[];i.forEach(function(n){var e,o,r;for(e=t.getRowColumn(n).column,r=(o=t.getRowColumn(n).row)*t.columns+e+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,u=t.getRowColumn(s).row,l=t.getRowColumn(s).row+s.rowspan;e>=i&&e<c&&o>=u&&o<l&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=Math.floor(i/t.columns),u=i%t.columns,l=(t.components[i].rowspan,t.components[i].colspan);t.components[i].get("text"),t.components[i].merged;if(u+l-1===n){for(var a=0;a<t.rows;a++)s.push(x(t.app));r.push(t.widths[n]);var h=t.columns,f=t.rows;s.reverse().forEach(function(n){0==f&&(f=t.rows,h++),f--,t.insertComponentAt(n,o+f*h)})}else if(u===n){t.components[i].colspan+=1;for(var m=0;m<t.rows;m++)s.push(k(t.components[n+t.columns*m].model,t.app));r.push(t.widths[n]);var d=t.columns,g=t.rows;s.reverse().forEach(function(n){0==g&&(g=t.rows,d++),g--,t.insertComponentAt(n,o+g*d)}),t.components[i+c+1].rowspan=1,t.components[i+c+1].colspan=1,t.components[i+c+1].merged=!0,t.components[i+c+1].set("text","")}else{t.components[i].colspan+=1;for(var w=0;w<t.rows;w++)s.push(k(t.components[n+t.columns*w].model,t.app));r.push(t.widths[n]);var v=t.columns,y=t.rows;s.reverse().forEach(function(n){0==y&&(y=t.rows,v++),y--,t.insertComponentAt(n,o+y*v)})}var C=t.widths.slice();t.model.columns+=e.length,C.splice.apply(C,[o,0].concat(r)),t.set("widths",C)})}})}},{key:"distributeHorizontal",value:function(n){var t=this,e=[];n.forEach(function(n){var o=t.getRowColumn(n);-1==e.indexOf(o.column)&&e.push(o.column)});var o=e.reduce(function(n,e){return n+t.widths[e]},0),r=Math.round(o/e.length*100)/100,s=this.widths.slice();e.forEach(function(n){s[n]=r}),this.set("widths",s)}},{key:"distributeVertical",value:function(n){var t=this,e=[];n.forEach(function(n){var o=t.getRowColumn(n);-1==e.indexOf(o.row)&&e.push(o.row)});var o=e.reduce(function(n,e){return n+t.heights[e]},0),r=Math.round(o/e.length*100)/100,s=this.heights.slice();e.forEach(function(n){s[n]=r}),this.set("heights",s)}},{key:"toObjectArrayValue",value:function(n){if(!n||0===n.length)return null;if(!n[0].hasOwnProperty("__field1"))return n;var t={},e=[];for(var o in n[0])t[o]=n[0][o];for(var r=1;r<n.length;r++){var s={},i=n[r];for(var c in t){var u=t[c],l=i[c];s[u]=l}e.push(s)}return e}},{key:"onchange",value:function(n,t){if("rows"in n||"columns"in n){var e=this.rows,o=this.columns;this.buildCells(e,o,"rows"in t?t.rows:e,"columns"in t?t.columns:o)}"data"in n&&this.setCellsData()}},{key:"oncellchanged",value:function(n,t){("dataKey"in n||"dataIndex"in n)&&this.setCellsData()}},{key:"focusible",get:function(){return!1}},{key:"widths",get:function(){var n=this.get("widths");return n?n.length<this.columns?n.concat(z(0,this.columns-n.length)):n.length>this.columns?n.slice(0,this.columns):n:z(0,this.columns)}},{key:"heights",get:function(){var n=this.get("heights");return n?n.length<this.rows?n.concat(z(0,this.rows-n.length)):n.length>this.rows?n.slice(0,this.rows):n:z(0,this.rows)}},{key:"layout",get:function(){return b}},{key:"rows",get:function(){return Number(this.get("rows"))}},{key:"columns",get:function(){return Number(this.get("columns"))}},{key:"lefts",get:function(){var n=this;return this.components.filter(function(t,e){return!(e%n.columns)})}},{key:"centers",get:function(){var n=this;return this.components.filter(function(t,e){return e%n.columns&&(e+1)%n.columns})}},{key:"rights",get:function(){var n=this;return this.components.filter(function(t,e){return!((e+1)%n.columns)})}},{key:"tops",get:function(){return this.components.slice(0,this.columns)}},{key:"middles",get:function(){return this.components.slice(this.columns,this.columns*(this.rows-1))}},{key:"bottoms",get:function(){return this.components.slice(this.columns*(this.rows-1))}},{key:"widths_sum",get:function(){var n=this,t=this.widths;return t?t.filter(function(t,e){return e<n.columns}).reduce(function(n,t){return n+t},0):this.columns}},{key:"heights_sum",get:function(){var n=this,t=this.heights;return t?t.filter(function(t,e){return e<n.rows}).reduce(function(n,t){return n+t},0):this.rows}},{key:"nature",get:function(){return w}},{key:"controls",get:function(){var n=this.widths,t=this.heights,e=this.textBounds,o=e.width/this.widths_sum,r=e.height/this.heights_sum,s=e.left,i=e.top,c=[];return n.slice(0,this.columns-1).forEach(function(n){s+=n*o,c.push({x:s,y:e.top,handler:D})}),t.slice(0,this.rows-1).forEach(function(n){i+=n*r,c.push({x:e.left,y:i,handler:T})}),c}},{key:"eventMap",get:function(){return{"(self)":{"(descendant)":{change:this.oncellchanged}}}}}]),t}();["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(function(n){return o.memoize(N.prototype,n,!1)}),o.register("table",N);var W={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!0,split:!0}},{type:"string",label:"data-key",name:"dataKey",property:"dataKey"},{type:"number",label:"data-index",name:"dataIndex",property:"dataIndex"}]};var I=function(n){function t(){return l(this,t),d(this,f(t).apply(this,arguments))}return p(t,r(o)),h(t,[{key:"_drawBorder",value:function(n,t,e,r,s,i){i&&i.strokeStyle&&i.lineWidth&&i.lineDash&&(n.beginPath(),n.moveTo(t,e),n.lineTo(r,s),o.drawStroke(n,i))}},{key:"_draw",value:function(n){var t=this.model,e=t.left,o=t.top,r=t.width,s=t.height,i=this.model.border||{};n.beginPath(),n.lineWidth=0,n.rect(e,o,r,s),this.drawFill(n);var c=this.parent,u=c.components.indexOf(this),l=c.columns||1,a=c.rows||1;this._drawBorder(n,e,o,e+r,o,i.top),this._drawBorder(n,e,o+s,e,o,i.left),function(n,t,e){return(n+1)%e==0}(u,0,l)&&this._drawBorder(n,e+r,o,e+r,o+s,i.right),function(n,t,e){return n>=(t-1)*e}(u,a,l)&&this._drawBorder(n,e+r,o+s,e,o+s,i.bottom)}},{key:"nature",get:function(){return W}},{key:"merged",set:function(n){this.set("merged",!!n),n&&this.set("text","")},get:function(){return this.get("merged")}},{key:"rowspan",set:function(n){this.set("rowspan",n)},get:function(){return this.get("rowspan")}},{key:"colspan",set:function(n){this.set("colspan",n)},get:function(){return this.get("colspan")}},{key:"border",get:function(){this.model.border}}]),t}();function K(){var n=g(["\n        :host {\n          display: block;\n          overflow-x: none;\n          overflow-y: auto;\n        }\n\n        #grid {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          border-top: 1px solid black;\n          border-right: 1px solid black;\n        }\n\n        span {\n          padding: 8px 4px;\n          border-left: 1px solid black;\n          border-bottom: 1px solid black;\n        }\n      "]);return K=function(){return n},n}function X(){var n=g(["\n      ","\n    "]);return X=function(){return n},n}function Y(){var n=g(['\n      <div id="grid">\n        ',"\n      </div>\n    "]);return Y=function(){return n},n}function V(){var n=g(["\n      ","\n    "]);return V=function(){return n},n}function J(){var n=g(["\n      <span>","</span>\n    "]);return J=function(){return n},n}["border"].forEach(function(n){return o.memoize(I.prototype,n,!1)}),o.register("table-cell",I);var F=function(n){function t(){var n;return l(this,t),(n=d(this,f(t).call(this))).data=[],n.format=[{height:100,fields:[{width:50,property:"aaa"},{width:50,property:"bbb"}]}],n}return p(t,u),h(t,[{key:"updated",value:function(n){}},{key:"field",value:function(n,t){return console.log("record",t),i(J(),t[n.property])}},{key:"row",value:function(n,t){var e=this;return i(V(),n.fields.map(function(n){return e.field(n,t)}))}},{key:"record",value:function(n){var t=this;return i(Y(),this.format.map(function(e){return t.row(e,n)}))}},{key:"render",value:function(){var n=this;return i(X(),this.data.map(function(t){return n.record(t)}))}}],[{key:"properties",get:function(){return{format:Array,data:Array}}},{key:"styles",get:function(){return[c(K())]}}]),t}();customElements.define("simple-grid-view",F);var H={mutable:!1,resizable:!0,rotatable:!0,properties:[],"value-property":"data"},L=function(n){function t(){return l(this,t),d(this,f(t).apply(this,arguments))}return p(t,s),h(t,[{key:"setElementProperties",value:function(n){n.data=this.data}},{key:"tagName",get:function(){return"simple-grid-view"}},{key:"nature",get:function(){return H}}]),t}();o.register("simple-grid",L);export{N as Table,I as TableCell,L as Grid};
//# sourceMappingURL=things-scene-table.mjs.map
