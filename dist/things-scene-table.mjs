import{Component as o,RectPath as t,Layout as n,Model as e,Container as r}from"@hatiolab/things-scene";function s(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function i(o,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}function c(o,t,n){return t&&i(o.prototype,t),n&&i(o,n),o}function l(o,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),t&&a(o,t)}function u(o){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function a(o,t){return(a=Object.setPrototypeOf||function(o,t){return o.__proto__=t,o})(o,t)}function h(o,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(o){if(void 0===o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}(o):t}var p={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!0,split:!0}},{type:"string",label:"data-key",name:"dataKey",property:"dataKey"},{type:"number",label:"data-index",name:"dataIndex",property:"dataIndex"}]};var m=function(n){function e(){return s(this,e),h(this,u(e).apply(this,arguments))}return l(e,t(o)),c(e,[{key:"_drawBorder",value:function(t,n,e,r,s,i){i&&i.strokeStyle&&i.lineWidth&&i.lineDash&&(t.beginPath(),t.moveTo(n,e),t.lineTo(r,s),o.drawStroke(t,i))}},{key:"_draw",value:function(o){var t=this.model,n=t.left,e=t.top,r=t.width,s=t.height,i=this.model.border||{};o.beginPath(),o.lineWidth=0,o.rect(n,e,r,s),this.drawFill(o);var c=this.parent,l=c.components.indexOf(this),u=c.columns||1,a=c.rows||1;this._drawBorder(o,n,e,n+r,e,i.top),this._drawBorder(o,n,e+s,n,e,i.left),function(o,t,n){return(o+1)%n==0}(l,0,u)&&this._drawBorder(o,n+r,e,n+r,e+s,i.right),function(o,t,n){return o>=(t-1)*n}(l,a,u)&&this._drawBorder(o,n+r,e+s,n,e+s,i.bottom)}},{key:"nature",get:function(){return p}},{key:"merged",set:function(o){this.set("merged",!!o),o&&this.set("text","")},get:function(){return this.get("merged")}},{key:"rowspan",set:function(o){this.set("rowspan",o)},get:function(){return this.get("rowspan")}},{key:"colspan",set:function(o){this.set("colspan",o)},get:function(){return this.get("colspan")}},{key:"border",get:function(){this.model.border}}]),e}();["border"].forEach(function(t){return o.memoize(m.prototype,t,!1)}),o.register("table-cell",m);var f={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"select",label:"data-spread-to",name:"spreadTo",property:{options:["text","data"]}}]},g={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},w={strokeStyle:"",lineDash:"solid",lineWidth:0},d={strokeStyle:"#999",lineDash:"solid",lineWidth:1},v=n.get("table");function y(o){for(var t=arguments.length,n=new Array(t>1?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];for(var r in n)if(o.hasOwnProperty(n[r]))return!0}function C(o){return e.compile({type:"table-cell",strokeStyle:"blue",left:0,top:0,width:1,height:1,textWrap:!0,border:x(d,"all")},o)}function b(o,t){var n=JSON.parse(JSON.stringify(o));return delete n.text,e.compile(n,t)}function x(o,t){return(g[t]||[]).reduce(function(t,n){return t[n]=o,t},{})}function k(o,t,n){o&&o.set("border",Object.assign({},o.get("border")||{},x(t,n)))}function R(o,t,n,e){return 0==e||!(e%t)||-1==n.indexOf(e-1)}function E(o,t,n,e){return e==o-1||e%t==t-1||-1==n.indexOf(e+1)}function O(o,t,n,e){return e<t||-1==n.indexOf(e-t)}function M(o,t,n,e){return e>o-t-1||-1==n.indexOf(e+t)}function _(o,t){return t-o}function B(o,t){return t+o}function A(o,t){return t%o?t-1:-1}function P(o,t){return(t+1)%o?t+1:-1}function S(o,t){for(var n=[],e=0;e<t;e++)n.push(1);return n}var j={ondragmove:function(o,t,n){var e=n.textBounds,r=e.left,s=(e.top,e.width),i=(e.height,n.widths_sum),c=n.widths.slice(),l=r+c.slice(0,t+1).reduce(function(o,t){return o+t},0)/i*s,u=(n.transcoordP2S(o.x,o.y).x-l)/s*i,a=i/s*10;u=u<0?-Math.min(c[t]-a,-u):Math.min(c[t+1]-a,u),c[t]=Math.round(100*(c[t]+u))/100,c[t+1]=Math.round(100*(c[t+1]-u))/100,n.set("widths",c)}},z={ondragmove:function(o,t,n){var e=n.textBounds,r=(e.left,e.top),s=(e.width,e.height),i=n.heights_sum,c=n.heights.slice();t-=n.columns-1;var l=r+c.slice(0,t+1).reduce(function(o,t){return o+t},0)/i*s,u=(n.transcoordP2S(o.x,o.y).y-l)/s*i,a=i/s*10;u=u<0?-Math.min(c[t]-a,-u):Math.min(c[t+1]-a,u),c[t]=Math.round(100*(c[t]+u))/100,c[t+1]=Math.round(100*(c[t+1]-u))/100,n.set("heights",c)}},D=function(o){function t(){return s(this,t),h(this,u(t).apply(this,arguments))}return l(t,r),c(t,[{key:"created",value:function(){var o=this.rows*this.columns,t=this.size()-o;if(0!=t){if(t>0){var n=this._components.slice(t);this.remove(n)}else{for(var e=[],r=0;r<-t;r++)e.push(C(this.app));this.add(e)}var s=this.get("widths"),i=this.get("heights");(!s||s.length<this.columns)&&this.set("widths",this.widths),(!i||i.length<this.rows)&&this.set("heights",this.heights)}}},{key:"buildCells",value:function(o,t,n,e){var r=this;if(o<n){var s=this._components.slice(e*o),i=[];if(s.forEach(function(o){(!0===o.merged||o.rowspan>1||o.colspan>1)&&i.push(o)}),i.length>0){var c=[],l=[];i.forEach(function(o){var t,n,s;for(t=r.components.indexOf(o)%e,s=(n=Math.floor(r.components.indexOf(o)/e))*e+t+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var u=r.components.indexOf(i)%e,a=r.components.indexOf(i)%e+i.colspan,h=Math.floor(r.components.indexOf(i)/e),p=Math.floor(r.components.indexOf(i)/e)+i.rowspan;t>=u&&t<a&&n>=h&&n<p&&-1==l.indexOf(s)&&(l.push(s),c.push(i))}}}),c.forEach(function(t){t.rowspan-=n-o})}this.remove(s)}var u=Math.min(o,n);if(t>e)for(var a=0;a<u;a++)for(var h=e;h<t;h++)this.insertComponentAt(C(this.app),a*t+h);else if(t<e){for(var p=[],m=0;m<u;m++)for(var f=t;f<e;f++)p.push(this.components[m*e+f]);var g=[];if(p.forEach(function(o){(!0===o.merged||o.rowspan>1||o.colspan>1)&&g.push(o)}),g.length>0){var w=[],d=[];g.forEach(function(o){var t,n,s;for(t=r.components.indexOf(o)%e,s=(n=Math.floor(r.components.indexOf(o)/e))*e+t+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var c=r.components.indexOf(i)%e,l=r.components.indexOf(i)%e+i.colspan,u=Math.floor(r.components.indexOf(i)/e),a=Math.floor(r.components.indexOf(i)/e)+i.rowspan;t>=c&&t<l&&n>=u&&n<a&&-1==d.indexOf(s)&&(d.push(s),w.push(i))}}}),w.forEach(function(o){o.colspan-=e-t})}this.remove(p)}if(o>n){for(var v=[],y=n;y<o;y++)for(var b=0;b<t;b++)v.push(C(this.app));this.add(v)}this.set({widths:this.widths,heights:this.heights})}},{key:"setCellsStyle",value:function(o,t,n){var e=this,r=this.components,s=r.length,i=this.get("columns"),c=[];o.forEach(function(o){if(c.push(o),o.colspan||o.rowspan)for(var t=e.getRowColumn(o).column,n=e.getRowColumn(o).row,r=n;r<n+o.rowspan;r++)for(var s=t;s<t+o.colspan;s++)r==n&&s==t||c.push(e.components[r*e.columns+s])});var l=c.map(function(o){return r.indexOf(o)});l.forEach(function(o){var e=r[o];switch(n){case"all":k(e,t,n),R(0,i,l,o)&&k(r[A(i,o)],t,"right"),E(s,i,l,o)&&k(r[P(i,o)],t,"left"),O(0,i,l,o)&&k(r[_(i,o)],t,"bottom"),M(s,i,l,o)&&k(r[B(i,o)],t,"top");break;case"in":R(0,i,l,o)||k(e,t,"left"),E(s,i,l,o)||k(e,t,"right"),O(0,i,l,o)||k(e,t,"top"),M(s,i,l,o)||k(e,t,"bottom");break;case"out":R(0,i,l,o)&&(k(e,t,"left"),k(r[A(i,o)],t,"right")),E(s,i,l,o)&&(k(e,t,"right"),k(r[P(i,o)],t,"left")),O(0,i,l,o)&&(k(e,t,"top"),k(r[_(i,o)],t,"bottom")),M(s,i,l,o)&&(k(e,t,"bottom"),k(r[B(i,o)],t,"top"));break;case"left":R(0,i,l,o)&&(k(e,t,"left"),k(r[A(i,o)],t,"right"));break;case"right":E(s,i,l,o)&&(k(e,t,"right"),k(r[P(i,o)],t,"left"));break;case"center":R(0,i,l,o)||k(e,t,"left"),E(s,i,l,o)||k(e,t,"right");break;case"middle":O(0,i,l,o)||k(e,t,"top"),M(s,i,l,o)||k(e,t,"bottom");break;case"top":O(0,i,l,o)&&(k(e,t,"top"),k(r[_(i,o)],t,"bottom"));break;case"bottom":M(s,i,l,o)&&(k(e,t,"bottom"),k(r[B(i,o)],t,"top"));break;case"clear":k(e,w,"all"),R(0,i,l,o)&&k(r[A(i,o)],w,"right"),E(s,i,l,o)&&k(r[P(i,o)],w,"left"),O(0,i,l,o)&&k(r[_(i,o)],w,"bottom"),M(s,i,l,o)&&k(r[B(i,o)],w,"top")}})}},{key:"setCellsData",value:function(){var o=this.data;if(o){o=this.toObjectArrayValue(o)||[];var t=this.components,n=this.state.spreadTo,e=void 0===n?"text":n;t.forEach(function(t){var n=t.model.dataKey,r=t.model.dataIndex;n&&r>=0&&(t[e]=(o[r]||{})[n])})}}},{key:"getRowColumn",value:function(o){var t=this.components.indexOf(o);this.components.length;return{column:t%this.columns,row:Math.floor(t/this.columns)}}},{key:"getCellsByRow",value:function(o){return this.components.slice(o*this.columns,(o+1)*this.columns)}},{key:"getCellsByColumn",value:function(o){for(var t=[],n=0;n<this.rows;n++)t.push(this.components[this.columns*n+o]);return t}},{key:"findMergedCellByX",value:function(o){for(var t,n=[],e=0;e<this.columns;e++)(!0===(t=this.components[o*this.columns+e]).merged||t.rowspan>1||t.colspan>1)&&n.push(t);return n}},{key:"findMergedCellByY",value:function(o){for(var t,n=[],e=0;e<this.rows;e++)(!0===(t=this.components[e*this.columns+o]).merged||t.rowspan>1||t.colspan>1)&&n.push(t);return n}},{key:"mergeCells",value:function(o){var t=this,n=[];if(o.forEach(function(o){var e=t.getRowColumn(o).row;-1==n.indexOf(e)&&n.push(e)}),n.length-1!=n[n.length-1]-n[0])return!1;var e=[];if(o.forEach(function(o){var n=t.getRowColumn(o).column;-1==e.indexOf(n)&&e.push(n)}),e.length-1!=e[e.length-1]-e[0])return!1;var r=n.length,s=e.length,i=o.length;if(i!==r*s||i<2)return!1;o.sort(function(o,n){return t.getRowColumn(o).row*t.columns+t.getRowColumn(o).column-(t.getRowColumn(n).row*t.columns+t.getRowColumn(n).column)});var c=o[0];c.set({colspan:s,rowspan:r});for(var l=1;l<i;l++)o[l].merged=!0;this.root.selected=[c]}},{key:"splitCells",value:function(o){this.getRowColumn(o[0]);for(var t=o[0],n=this.components.indexOf(o[0]),e=this.components.length,r=this.components[e-1],s=e/(this.getRowColumn(r).row+1),i=0;i<t.rowspan;i++)for(var c=void 0,l=n;l<n+t.colspan;l++)c=s*i+l,this.components[c].merged=!1;t.colspan=1,t.rowspan=1}},{key:"deleteRows",value:function(o){var t=this;if(1==o[0].merged)return!1;var n=[];o.forEach(function(o){var e=t.getRowColumn(o).row;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse();var e=this.heights.slice();n.forEach(function(o){var n=t.findMergedCellByX(o);if(0===n.length)t.remove(t.getCellsByRow(o));else{var e=[],r=[];n.forEach(function(o){var n,s,i;for(n=t.getRowColumn(o).column,i=(s=t.getRowColumn(o).row)*t.columns+n+1;i;){--i;var c=t.components[i];if(c.rowspan>1||c.colspan>1){var l=t.getRowColumn(c).column,u=t.getRowColumn(c).column+c.colspan,a=t.getRowColumn(c).row,h=t.getRowColumn(c).row+c.rowspan;n>=l&&n<u&&s>=a&&s<h&&-1==r.indexOf(i)&&(r.push(i),e.push(c))}}}),r.forEach(function(n){var e=Math.floor(n/t.columns);o===e&&e!==t.rows-1&&t.components[n].rowspan>1?(t.components[n+t.columns].rowspan=t.components[n].rowspan-1,t.components[n+t.columns].colspan=t.components[n].colspan,t.components[n+t.columns].merged=!1,t.components[n+t.columns].set("text",t.components[n].get("text"))):t.components[n].rowspan-=1}),t.remove(t.getCellsByRow(o))}}),e.splice(n,1),this.model.rows-=n.length,this.set("heights",e)}},{key:"deleteColumns",value:function(o){var t=this;if(1==o[0].merged)return!1;var n=[];o.forEach(function(o){var e=t.getRowColumn(o).column;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse(),n.forEach(function(o){var n=t.widths.slice(),e=t.findMergedCellByY(o);if(0===e.length)t.remove(t.getCellsByColumn(o));else{var r=[],s=[];e.forEach(function(o){var n,e,i;for(n=t.getRowColumn(o).column,i=(e=t.getRowColumn(o).row)*t.columns+n+1;i;){--i;var c=t.components[i];if(c.rowspan>1||c.colspan>1){var l=t.getRowColumn(c).column,u=t.getRowColumn(c).column+c.colspan,a=t.getRowColumn(c).row,h=t.getRowColumn(c).row+c.rowspan;n>=l&&n<u&&e>=a&&e<h&&-1==s.indexOf(i)&&(s.push(i),r.push(c))}}}),s.forEach(function(n){var e=n%t.columns;o===e&&e!==t.columns-1&&t.components[n].colspan>1?(t.components[n+1].rowspan=t.components[n].rowspan,t.components[n+1].colspan=t.components[n].colspan-1,t.components[n+1].merged=!1,t.components[n+1].set("text",t.components[n].get("text"))):t.components[n].colspan-=1}),t.remove(t.getCellsByColumn(o))}n.splice(o,1),t.model.columns-=1,t.set("widths",n)})}},{key:"insertCellsAbove",value:function(o){var t=this,n=[];if(o.forEach(function(o){var e=t.getRowColumn(o).row;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse(),n.length>=2)return!1;var e=n[0],r=[],s=[];n.forEach(function(o){var i=t.findMergedCellByX(o);if(0===i.length){for(var c=0;c<t.columns;c++)s.push(b(t.components[o*t.columns+c].model,t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)});var l=t.heights.slice();l.splice.apply(l,[e,0].concat(r)),t.set("heights",l),t.model.rows+=n.length,t.clearCache()}else{if(n.length>1)return!1;var u=[],a=[];i.forEach(function(o){var n,e,r;for(n=t.getRowColumn(o).column,r=(e=t.getRowColumn(o).row)*t.columns+n+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,l=t.getRowColumn(s).row,h=t.getRowColumn(s).row+s.rowspan;n>=i&&n<c&&e>=l&&e<h&&-1==a.indexOf(r)&&(a.push(r),u.push(s))}}}),a.forEach(function(i){if(a.length>=2)return!1;var c=Math.floor(i/t.columns),l={rowspan:t.components[i].rowspan,colspan:t.components[i].colspan,text:t.components[i].get("text"),merged:t.components[i].merged};if(c===o){for(var u=0;u<t.columns;u++)s.push(C(t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)}),t.components[i+t.columns].rowspan=l.rowspan,t.components[i+t.columns].colspan=l.colspan,t.components[i+t.columns].set("text",l.text),t.components[i+t.columns].merged=l.merged}else{for(var h=0;h<t.columns;h++)s.push(b(t.components[o*t.columns+h].model,t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)}),t.components[i].rowspan+=1}var p=t.heights.slice();p.splice.apply(p,[e,0].concat(r)),t.set("heights",p),t.model.rows+=n.length,t.clearCache()})}})}},{key:"insertCellsBelow",value:function(o){var t=this,n=[];if(o.forEach(function(o){var e=t.getRowColumn(o).row;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse(),n.length>=2)return!1;var e=n[n.length-1]+1,r=[],s=[];n.forEach(function(o){var n=t.findMergedCellByX(o);if(0===n.length){for(var i=0;i<t.columns;i++)s.push(b(t.components[o*t.columns+i].model,t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)});var c=t.heights.slice();c.splice.apply(c,[e,0].concat(r)),t.set("heights",c),t.model.rows+=1,t.clearCache()}else{var l=[],u=[];n.forEach(function(o){var n,e,r;for(n=t.getRowColumn(o).column,r=(e=t.getRowColumn(o).row)*t.columns+n+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,a=t.getRowColumn(s).row,h=t.getRowColumn(s).row+s.rowspan;n>=i&&n<c&&e>=a&&e<h&&-1==u.indexOf(r)&&(u.push(r),l.push(s))}}}),u.forEach(function(n){if(u.length>=2)return!1;var i=Math.floor(n/t.columns),c=t.components[n].rowspan;t.components[n].colspan,t.components[n].get("text"),t.components[n].merged;if(i+c-1===o){for(var l=0;l<t.columns;l++)s.push(C(t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)})}else if(i===o){for(var a=0;a<t.columns;a++)s.push(b(t.components[o*t.columns+a].model,t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)}),t.components[n].rowspan+=1,t.components[n+t.columns].rowspan=1,t.components[n+t.columns].colspan=1,t.components[n+t.columns].merged=!0,t.components[n+t.columns].set("text","")}else{for(var h=0;h<t.columns;h++)s.push(b(t.components[o*t.columns+h].model,t.app));r.push(t.heights[o]),s.reverse().forEach(function(o){t.insertComponentAt(o,e*t.columns)}),t.components[n].rowspan+=1}var p=t.heights.slice();p.splice.apply(p,[e,0].concat(r)),t.set("heights",p),t.model.rows+=1,t.clearCache()})}})}},{key:"insertCellsLeft",value:function(o){var t=this,n=[];if(o.forEach(function(o){var e=t.getRowColumn(o).column;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse(),n.length>=2)return!1;var e=n[0],r=[],s=[];n.forEach(function(o){var i=t.findMergedCellByY(o);if(0===i.length){for(var c=0;c<t.rows;c++)s.push(b(t.components[o+t.columns*c].model,t.app));r.push(t.widths[o]);var l=t.columns,u=t.rows;s.reverse().forEach(function(o){0==u&&(u=t.rows,l++),u--,t.insertComponentAt(o,e+u*l)});var a=t.widths.slice();t.model.columns+=n.length,a.splice.apply(a,[e,0].concat(r)),t.set("widths",a)}else{var h=[],p=[];i.forEach(function(o){var n,e,r;for(n=t.getRowColumn(o).column,r=(e=t.getRowColumn(o).row)*t.columns+n+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,l=t.getRowColumn(s).row,u=t.getRowColumn(s).row+s.rowspan;n>=i&&n<c&&e>=l&&e<u&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=i%t.columns;t.components[i].rowspan,t.components[i].colspan,t.components[i].get("text"),t.components[i].merged;if(c===o){for(var l=0;l<t.rows;l++)s.push(C(t.app));r.push(t.widths[o]);var u=t.columns,a=t.rows;s.reverse().forEach(function(o){0==a&&(a=t.rows,u++),a--,t.insertComponentAt(o,e+a*u)})}else{t.components[i].colspan+=1;for(var h=0;h<t.rows;h++)s.push(b(t.components[o+t.columns*h].model,t.app));r.push(t.widths[o]);var m=t.columns,f=t.rows;s.reverse().forEach(function(o){0==f&&(f=t.rows,m++),f--,t.insertComponentAt(o,e+f*m)})}var g=t.widths.slice();t.model.columns+=n.length,g.splice.apply(g,[e,0].concat(r)),t.set("widths",g)})}})}},{key:"insertCellsRight",value:function(o){var t=this,n=[];if(o.forEach(function(o){var e=t.getRowColumn(o).column;-1==n.indexOf(e)&&n.push(e)}),n.sort(function(o,t){return o-t}),n.reverse(),n.length>=2)return!1;var e=n[n.length-1]+1,r=[],s=[];n.forEach(function(o){var i=t.findMergedCellByY(o);if(0===i.length){for(var c=0;c<t.rows;c++)s.push(b(t.components[o+t.columns*c].model,t.app));r.push(t.widths[o]);var l=t.columns,u=t.rows;s.reverse().forEach(function(o){0==u&&(u=t.rows,l++),u--,t.insertComponentAt(o,e+u*l)});var a=t.widths.slice();t.model.columns+=n.length,a.splice.apply(a,[e,0].concat(r)),t.set("widths",a)}else{var h=[],p=[];i.forEach(function(o){var n,e,r;for(n=t.getRowColumn(o).column,r=(e=t.getRowColumn(o).row)*t.columns+n+1;r;){--r;var s=t.components[r];if(s.rowspan>1||s.colspan>1){var i=t.getRowColumn(s).column,c=t.getRowColumn(s).column+s.colspan,l=t.getRowColumn(s).row,u=t.getRowColumn(s).row+s.rowspan;n>=i&&n<c&&e>=l&&e<u&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=Math.floor(i/t.columns),l=i%t.columns,u=(t.components[i].rowspan,t.components[i].colspan);t.components[i].get("text"),t.components[i].merged;if(l+u-1===o){for(var a=0;a<t.rows;a++)s.push(C(t.app));r.push(t.widths[o]);var h=t.columns,m=t.rows;s.reverse().forEach(function(o){0==m&&(m=t.rows,h++),m--,t.insertComponentAt(o,e+m*h)})}else if(l===o){t.components[i].colspan+=1;for(var f=0;f<t.rows;f++)s.push(b(t.components[o+t.columns*f].model,t.app));r.push(t.widths[o]);var g=t.columns,w=t.rows;s.reverse().forEach(function(o){0==w&&(w=t.rows,g++),w--,t.insertComponentAt(o,e+w*g)}),t.components[i+c+1].rowspan=1,t.components[i+c+1].colspan=1,t.components[i+c+1].merged=!0,t.components[i+c+1].set("text","")}else{t.components[i].colspan+=1;for(var d=0;d<t.rows;d++)s.push(b(t.components[o+t.columns*d].model,t.app));r.push(t.widths[o]);var v=t.columns,y=t.rows;s.reverse().forEach(function(o){0==y&&(y=t.rows,v++),y--,t.insertComponentAt(o,e+y*v)})}var x=t.widths.slice();t.model.columns+=n.length,x.splice.apply(x,[e,0].concat(r)),t.set("widths",x)})}})}},{key:"distributeHorizontal",value:function(o){var t=this,n=[];o.forEach(function(o){var e=t.getRowColumn(o);-1==n.indexOf(e.column)&&n.push(e.column)});var e=n.reduce(function(o,n){return o+t.widths[n]},0),r=Math.round(e/n.length*100)/100,s=this.widths.slice();n.forEach(function(o){s[o]=r}),this.set("widths",s)}},{key:"distributeVertical",value:function(o){var t=this,n=[];o.forEach(function(o){var e=t.getRowColumn(o);-1==n.indexOf(e.row)&&n.push(e.row)});var e=n.reduce(function(o,n){return o+t.heights[n]},0),r=Math.round(e/n.length*100)/100,s=this.heights.slice();n.forEach(function(o){s[o]=r}),this.set("heights",s)}},{key:"toObjectArrayValue",value:function(o){if(!o||0===o.length)return null;if(!o[0].hasOwnProperty("__field1"))return o;var t={},n=[];for(var e in o[0])t[e]=o[0][e];for(var r=1;r<o.length;r++){var s={},i=o[r];for(var c in t){var l=t[c],u=i[c];s[l]=u}n.push(s)}return n}},{key:"onchange",value:function(o,t){y(o,"rows","columns")&&this.buildCells(this.get("rows"),this.get("columns"),t.hasOwnProperty("rows")?t.rows:this.get("rows"),t.hasOwnProperty("columns")?t.columns:this.get("columns")),(t.data||o.data)&&this.setCellsData()}},{key:"oncellchanged",value:function(o,t){y(o,"dataKey","dataIndex")&&this.setCellsData()}},{key:"focusible",get:function(){return!1}},{key:"widths",get:function(){var o=this.get("widths");return o?o.length<this.columns?o.concat(S(0,this.columns-o.length)):o.length>this.columns?o.slice(0,this.columns):o:S(0,this.columns)}},{key:"heights",get:function(){var o=this.get("heights");return o?o.length<this.rows?o.concat(S(0,this.rows-o.length)):o.length>this.rows?o.slice(0,this.rows):o:S(0,this.rows)}},{key:"layout",get:function(){return v}},{key:"rows",get:function(){return this.get("rows")}},{key:"columns",get:function(){return this.get("columns")}},{key:"lefts",get:function(){var o=this;return this.components.filter(function(t,n){return!(n%o.columns)})}},{key:"centers",get:function(){var o=this;return this.components.filter(function(t,n){return n%o.columns&&(n+1)%o.columns})}},{key:"rights",get:function(){var o=this;return this.components.filter(function(t,n){return!((n+1)%o.columns)})}},{key:"tops",get:function(){return this.components.slice(0,this.columns)}},{key:"middles",get:function(){return this.components.slice(this.columns,this.columns*(this.rows-1))}},{key:"bottoms",get:function(){return this.components.slice(this.columns*(this.rows-1))}},{key:"all",get:function(){return this.components}},{key:"widths_sum",get:function(){var o=this,t=this.widths;return t?t.filter(function(t,n){return n<o.columns}).reduce(function(o,t){return o+t},0):this.columns}},{key:"heights_sum",get:function(){var o=this,t=this.heights;return t?t.filter(function(t,n){return n<o.rows}).reduce(function(o,t){return o+t},0):this.rows}},{key:"nature",get:function(){return f}},{key:"controls",get:function(){var o=this.widths,t=this.heights,n=this.textBounds,e=n.width/this.widths_sum,r=n.height/this.heights_sum,s=n.left,i=n.top,c=[];return o.slice(0,this.columns-1).forEach(function(o){s+=o*e,c.push({x:s,y:n.top,handler:j})}),t.slice(0,this.rows-1).forEach(function(o){i+=o*r,c.push({x:n.left,y:i,handler:z})}),c}},{key:"eventMap",get:function(){return{"(self)":{"(descendant)":{change:this.oncellchanged}}}}}]),t}();["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(function(t){return o.memoize(D.prototype,t,!1)}),o.register("table",D);export{D as Table};
