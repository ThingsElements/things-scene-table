!function(o,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@hatiolab/things-scene")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene"],n):n((o=o||self)["things-scene-table"]={},o.scene)}(this,function(o,n){"use strict";function t(o,n){if(!(o instanceof n))throw new TypeError("Cannot call a class as a function")}function e(o,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}function s(o,n,t){return n&&e(o.prototype,n),t&&e(o,t),o}function r(o,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(n&&n.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),n&&c(o,n)}function i(o){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function c(o,n){return(c=Object.setPrototypeOf||function(o,n){return o.__proto__=n,o})(o,n)}function l(o,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(o){if(void 0===o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}(o):n}var u={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"select",label:"data-spread-to",name:"spreadTo",property:{options:["text","data"]}}],"value-property":"data"},a={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},h={strokeStyle:"",lineDash:"solid",lineWidth:0},p={strokeStyle:"#999",lineDash:"solid",lineWidth:1},m=n.Layout.get("table");function f(o){return n.Model.compile({type:"table-cell",strokeStyle:"blue",left:0,top:0,width:1,height:1,textWrap:!0,border:d(p,"all")},o)}function g(o,t){var e=JSON.parse(JSON.stringify(o));return delete e.text,n.Model.compile(e,t)}function d(o,n){return(a[n]||[]).reduce(function(n,t){return n[t]=o,n},{})}function w(o,n,t){o&&o.set("border",Object.assign({},o.get("border")||{},d(n,t)))}function v(o,n,t,e){return 0==e||!(e%n)||-1==t.indexOf(e-1)}function y(o,n,t,e){return e==o-1||e%n==n-1||-1==t.indexOf(e+1)}function C(o,n,t,e){return e<n||-1==t.indexOf(e-n)}function b(o,n,t,e){return e>o-n-1||-1==t.indexOf(e+n)}function x(o,n){return n-o}function k(o,n){return n+o}function R(o,n){return n%o?n-1:-1}function E(o,n){return(n+1)%o?n+1:-1}function O(o,n){for(var t=[],e=0;e<n;e++)t.push(1);return t}var M={ondragmove:function(o,n,t){var e=t.textBounds,s=e.left,r=(e.top,e.width),i=(e.height,t.widths_sum),c=t.widths.slice(),l=s+c.slice(0,n+1).reduce(function(o,n){return o+n},0)/i*r,u=(t.transcoordP2S(o.x,o.y).x-l)/r*i,a=i/r*10;u=u<0?-Math.min(c[n]-a,-u):Math.min(c[n+1]-a,u),c[n]=Math.round(100*(c[n]+u))/100,c[n+1]=Math.round(100*(c[n+1]-u))/100,t.set("widths",c)}},_={ondragmove:function(o,n,t){var e=t.textBounds,s=(e.left,e.top),r=(e.width,e.height),i=t.heights_sum,c=t.heights.slice();n-=t.columns-1;var l=s+c.slice(0,n+1).reduce(function(o,n){return o+n},0)/i*r,u=(t.transcoordP2S(o.x,o.y).y-l)/r*i,a=i/r*10;u=u<0?-Math.min(c[n]-a,-u):Math.min(c[n+1]-a,u),c[n]=Math.round(100*(c[n]+u))/100,c[n+1]=Math.round(100*(c[n+1]-u))/100,t.set("heights",c)}},B=function(o){function e(){return t(this,e),l(this,i(e).apply(this,arguments))}return r(e,n.Container),s(e,[{key:"created",value:function(){var o=this.rows*this.columns,n=this.size()-o;if(0!=n){if(n>0){var t=this._components.slice(n);this.remove(t)}else{for(var e=[],s=0;s<-n;s++)e.push(f(this.app));this.add(e)}var r=this.get("widths"),i=this.get("heights");(!r||r.length<this.columns)&&this.set("widths",this.widths),(!i||i.length<this.rows)&&this.set("heights",this.heights)}}},{key:"buildCells",value:function(o,n,t,e){var s=this;if(o<t){var r=this._components.slice(e*o),i=[];if(r.forEach(function(o){(!0===o.merged||o.rowspan>1||o.colspan>1)&&i.push(o)}),i.length>0){var c=[],l=[];i.forEach(function(o){var n,t,r;for(n=s.components.indexOf(o)%e,r=(t=Math.floor(s.components.indexOf(o)/e))*e+n+1;r;){--r;var i=s.components[r];if(i.rowspan>1||i.colspan>1){var u=s.components.indexOf(i)%e,a=s.components.indexOf(i)%e+i.colspan,h=Math.floor(s.components.indexOf(i)/e),p=Math.floor(s.components.indexOf(i)/e)+i.rowspan;n>=u&&n<a&&t>=h&&t<p&&-1==l.indexOf(r)&&(l.push(r),c.push(i))}}}),c.forEach(function(n){n.rowspan-=t-o})}this.remove(r)}var u=Math.min(o,t);if(n>e)for(var a=0;a<u;a++)for(var h=e;h<n;h++)this.insertComponentAt(f(this.app),a*n+h);else if(n<e){for(var p=[],m=0;m<u;m++)for(var g=n;g<e;g++)p.push(this.components[m*e+g]);var d=[];if(p.forEach(function(o){(!0===o.merged||o.rowspan>1||o.colspan>1)&&d.push(o)}),d.length>0){var w=[],v=[];d.forEach(function(o){var n,t,r;for(n=s.components.indexOf(o)%e,r=(t=Math.floor(s.components.indexOf(o)/e))*e+n+1;r;){--r;var i=s.components[r];if(i.rowspan>1||i.colspan>1){var c=s.components.indexOf(i)%e,l=s.components.indexOf(i)%e+i.colspan,u=Math.floor(s.components.indexOf(i)/e),a=Math.floor(s.components.indexOf(i)/e)+i.rowspan;n>=c&&n<l&&t>=u&&t<a&&-1==v.indexOf(r)&&(v.push(r),w.push(i))}}}),w.forEach(function(o){o.colspan-=e-n})}this.remove(p)}if(o>t){for(var y=[],C=t;C<o;C++)for(var b=0;b<n;b++)y.push(f(this.app));this.add(y)}this.set({widths:this.widths,heights:this.heights})}},{key:"setCellsStyle",value:function(o,n,t){var e=this,s=this.components,r=s.length,i=this.get("columns"),c=[];o.forEach(function(o){if(c.push(o),o.colspan||o.rowspan)for(var n=e.getRowColumn(o).column,t=e.getRowColumn(o).row,s=t;s<t+o.rowspan;s++)for(var r=n;r<n+o.colspan;r++)s==t&&r==n||c.push(e.components[s*e.columns+r])});var l=c.map(function(o){return s.indexOf(o)});l.forEach(function(o){var e=s[o];switch(t){case"all":w(e,n,t),v(0,i,l,o)&&w(s[R(i,o)],n,"right"),y(r,i,l,o)&&w(s[E(i,o)],n,"left"),C(0,i,l,o)&&w(s[x(i,o)],n,"bottom"),b(r,i,l,o)&&w(s[k(i,o)],n,"top");break;case"in":v(0,i,l,o)||w(e,n,"left"),y(r,i,l,o)||w(e,n,"right"),C(0,i,l,o)||w(e,n,"top"),b(r,i,l,o)||w(e,n,"bottom");break;case"out":v(0,i,l,o)&&(w(e,n,"left"),w(s[R(i,o)],n,"right")),y(r,i,l,o)&&(w(e,n,"right"),w(s[E(i,o)],n,"left")),C(0,i,l,o)&&(w(e,n,"top"),w(s[x(i,o)],n,"bottom")),b(r,i,l,o)&&(w(e,n,"bottom"),w(s[k(i,o)],n,"top"));break;case"left":v(0,i,l,o)&&(w(e,n,"left"),w(s[R(i,o)],n,"right"));break;case"right":y(r,i,l,o)&&(w(e,n,"right"),w(s[E(i,o)],n,"left"));break;case"center":v(0,i,l,o)||w(e,n,"left"),y(r,i,l,o)||w(e,n,"right");break;case"middle":C(0,i,l,o)||w(e,n,"top"),b(r,i,l,o)||w(e,n,"bottom");break;case"top":C(0,i,l,o)&&(w(e,n,"top"),w(s[x(i,o)],n,"bottom"));break;case"bottom":b(r,i,l,o)&&(w(e,n,"bottom"),w(s[k(i,o)],n,"top"));break;case"clear":w(e,h,"all"),v(0,i,l,o)&&w(s[R(i,o)],h,"right"),y(r,i,l,o)&&w(s[E(i,o)],h,"left"),C(0,i,l,o)&&w(s[x(i,o)],h,"bottom"),b(r,i,l,o)&&w(s[k(i,o)],h,"top")}})}},{key:"setCellsData",value:function(){var o=this.data;if(o){o=this.toObjectArrayValue(o)||[];var n=this.components,t=this.state.spreadTo,e=void 0===t?"text":t;n.forEach(function(n){var t=n.model.dataKey,s=n.model.dataIndex;t&&s>=0&&(n[e]=(o[s]||{})[t])})}}},{key:"getRowColumn",value:function(o){var n=this.components.indexOf(o);this.components.length;return{column:n%this.columns,row:Math.floor(n/this.columns)}}},{key:"getCellsByRow",value:function(o){return this.components.slice(o*this.columns,(o+1)*this.columns)}},{key:"getCellsByColumn",value:function(o){for(var n=[],t=0;t<this.rows;t++)n.push(this.components[this.columns*t+o]);return n}},{key:"findMergedCellByX",value:function(o){for(var n,t=[],e=0;e<this.columns;e++)(!0===(n=this.components[o*this.columns+e]).merged||n.rowspan>1||n.colspan>1)&&t.push(n);return t}},{key:"findMergedCellByY",value:function(o){for(var n,t=[],e=0;e<this.rows;e++)(!0===(n=this.components[e*this.columns+o]).merged||n.rowspan>1||n.colspan>1)&&t.push(n);return t}},{key:"mergeCells",value:function(o){var n=this,t=[];if(o.forEach(function(o){var e=n.getRowColumn(o).row;-1==t.indexOf(e)&&t.push(e)}),t.length-1!=t[t.length-1]-t[0])return!1;var e=[];if(o.forEach(function(o){var t=n.getRowColumn(o).column;-1==e.indexOf(t)&&e.push(t)}),e.length-1!=e[e.length-1]-e[0])return!1;var s=t.length,r=e.length,i=o.length;if(i!==s*r||i<2)return!1;o.sort(function(o,t){return n.getRowColumn(o).row*n.columns+n.getRowColumn(o).column-(n.getRowColumn(t).row*n.columns+n.getRowColumn(t).column)});var c=o[0];c.set({colspan:r,rowspan:s});for(var l=1;l<i;l++)o[l].merged=!0;this.root.selected=[c]}},{key:"splitCells",value:function(o){this.getRowColumn(o[0]);for(var n=o[0],t=this.components.indexOf(o[0]),e=this.components.length,s=this.components[e-1],r=e/(this.getRowColumn(s).row+1),i=0;i<n.rowspan;i++)for(var c=void 0,l=t;l<t+n.colspan;l++)c=r*i+l,this.components[c].merged=!1;n.colspan=1,n.rowspan=1}},{key:"deleteRows",value:function(o){var n=this;if(1==o[0].merged)return!1;var t=[];o.forEach(function(o){var e=n.getRowColumn(o).row;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse();var e=this.heights.slice();t.forEach(function(o){var t=n.findMergedCellByX(o);if(0===t.length)n.remove(n.getCellsByRow(o));else{var e=[],s=[];t.forEach(function(o){var t,r,i;for(t=n.getRowColumn(o).column,i=(r=n.getRowColumn(o).row)*n.columns+t+1;i;){--i;var c=n.components[i];if(c.rowspan>1||c.colspan>1){var l=n.getRowColumn(c).column,u=n.getRowColumn(c).column+c.colspan,a=n.getRowColumn(c).row,h=n.getRowColumn(c).row+c.rowspan;t>=l&&t<u&&r>=a&&r<h&&-1==s.indexOf(i)&&(s.push(i),e.push(c))}}}),s.forEach(function(t){var e=Math.floor(t/n.columns);o===e&&e!==n.rows-1&&n.components[t].rowspan>1?(n.components[t+n.columns].rowspan=n.components[t].rowspan-1,n.components[t+n.columns].colspan=n.components[t].colspan,n.components[t+n.columns].merged=!1,n.components[t+n.columns].set("text",n.components[t].get("text"))):n.components[t].rowspan-=1}),n.remove(n.getCellsByRow(o))}}),e.splice(t,1),this.model.rows-=t.length,this.set("heights",e)}},{key:"deleteColumns",value:function(o){var n=this;if(1==o[0].merged)return!1;var t=[];o.forEach(function(o){var e=n.getRowColumn(o).column;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse(),t.forEach(function(o){var t=n.widths.slice(),e=n.findMergedCellByY(o);if(0===e.length)n.remove(n.getCellsByColumn(o));else{var s=[],r=[];e.forEach(function(o){var t,e,i;for(t=n.getRowColumn(o).column,i=(e=n.getRowColumn(o).row)*n.columns+t+1;i;){--i;var c=n.components[i];if(c.rowspan>1||c.colspan>1){var l=n.getRowColumn(c).column,u=n.getRowColumn(c).column+c.colspan,a=n.getRowColumn(c).row,h=n.getRowColumn(c).row+c.rowspan;t>=l&&t<u&&e>=a&&e<h&&-1==r.indexOf(i)&&(r.push(i),s.push(c))}}}),r.forEach(function(t){var e=t%n.columns;o===e&&e!==n.columns-1&&n.components[t].colspan>1?(n.components[t+1].rowspan=n.components[t].rowspan,n.components[t+1].colspan=n.components[t].colspan-1,n.components[t+1].merged=!1,n.components[t+1].set("text",n.components[t].get("text"))):n.components[t].colspan-=1}),n.remove(n.getCellsByColumn(o))}t.splice(o,1),n.model.columns-=1,n.set("widths",t)})}},{key:"insertCellsAbove",value:function(o){var n=this,t=[];if(o.forEach(function(o){var e=n.getRowColumn(o).row;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse(),t.length>=2)return!1;var e=t[0],s=[],r=[];t.forEach(function(o){var i=n.findMergedCellByX(o);if(0===i.length){for(var c=0;c<n.columns;c++)r.push(g(n.components[o*n.columns+c].model,n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)});var l=n.heights.slice();l.splice.apply(l,[e,0].concat(s)),n.set("heights",l),n.model.rows+=t.length,n.clearCache()}else{if(t.length>1)return!1;var u=[],a=[];i.forEach(function(o){var t,e,s;for(t=n.getRowColumn(o).column,s=(e=n.getRowColumn(o).row)*n.columns+t+1;s;){--s;var r=n.components[s];if(r.rowspan>1||r.colspan>1){var i=n.getRowColumn(r).column,c=n.getRowColumn(r).column+r.colspan,l=n.getRowColumn(r).row,h=n.getRowColumn(r).row+r.rowspan;t>=i&&t<c&&e>=l&&e<h&&-1==a.indexOf(s)&&(a.push(s),u.push(r))}}}),a.forEach(function(i){if(a.length>=2)return!1;var c=Math.floor(i/n.columns),l={rowspan:n.components[i].rowspan,colspan:n.components[i].colspan,text:n.components[i].get("text"),merged:n.components[i].merged};if(c===o){for(var u=0;u<n.columns;u++)r.push(f(n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)}),n.components[i+n.columns].rowspan=l.rowspan,n.components[i+n.columns].colspan=l.colspan,n.components[i+n.columns].set("text",l.text),n.components[i+n.columns].merged=l.merged}else{for(var h=0;h<n.columns;h++)r.push(g(n.components[o*n.columns+h].model,n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)}),n.components[i].rowspan+=1}var p=n.heights.slice();p.splice.apply(p,[e,0].concat(s)),n.set("heights",p),n.model.rows+=t.length,n.clearCache()})}})}},{key:"insertCellsBelow",value:function(o){var n=this,t=[];if(o.forEach(function(o){var e=n.getRowColumn(o).row;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse(),t.length>=2)return!1;var e=t[t.length-1]+1,s=[],r=[];t.forEach(function(o){var t=n.findMergedCellByX(o);if(0===t.length){for(var i=0;i<n.columns;i++)r.push(g(n.components[o*n.columns+i].model,n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)});var c=n.heights.slice();c.splice.apply(c,[e,0].concat(s)),n.set("heights",c),n.model.rows+=1,n.clearCache()}else{var l=[],u=[];t.forEach(function(o){var t,e,s;for(t=n.getRowColumn(o).column,s=(e=n.getRowColumn(o).row)*n.columns+t+1;s;){--s;var r=n.components[s];if(r.rowspan>1||r.colspan>1){var i=n.getRowColumn(r).column,c=n.getRowColumn(r).column+r.colspan,a=n.getRowColumn(r).row,h=n.getRowColumn(r).row+r.rowspan;t>=i&&t<c&&e>=a&&e<h&&-1==u.indexOf(s)&&(u.push(s),l.push(r))}}}),u.forEach(function(t){if(u.length>=2)return!1;var i=Math.floor(t/n.columns),c=n.components[t].rowspan;n.components[t].colspan,n.components[t].get("text"),n.components[t].merged;if(i+c-1===o){for(var l=0;l<n.columns;l++)r.push(f(n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)})}else if(i===o){for(var a=0;a<n.columns;a++)r.push(g(n.components[o*n.columns+a].model,n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)}),n.components[t].rowspan+=1,n.components[t+n.columns].rowspan=1,n.components[t+n.columns].colspan=1,n.components[t+n.columns].merged=!0,n.components[t+n.columns].set("text","")}else{for(var h=0;h<n.columns;h++)r.push(g(n.components[o*n.columns+h].model,n.app));s.push(n.heights[o]),r.reverse().forEach(function(o){n.insertComponentAt(o,e*n.columns)}),n.components[t].rowspan+=1}var p=n.heights.slice();p.splice.apply(p,[e,0].concat(s)),n.set("heights",p),n.model.rows+=1,n.clearCache()})}})}},{key:"insertCellsLeft",value:function(o){var n=this,t=[];if(o.forEach(function(o){var e=n.getRowColumn(o).column;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse(),t.length>=2)return!1;var e=t[0],s=[],r=[];t.forEach(function(o){var i=n.findMergedCellByY(o);if(0===i.length){for(var c=0;c<n.rows;c++)r.push(g(n.components[o+n.columns*c].model,n.app));s.push(n.widths[o]);var l=n.columns,u=n.rows;r.reverse().forEach(function(o){0==u&&(u=n.rows,l++),u--,n.insertComponentAt(o,e+u*l)});var a=n.widths.slice();n.model.columns+=t.length,a.splice.apply(a,[e,0].concat(s)),n.set("widths",a)}else{var h=[],p=[];i.forEach(function(o){var t,e,s;for(t=n.getRowColumn(o).column,s=(e=n.getRowColumn(o).row)*n.columns+t+1;s;){--s;var r=n.components[s];if(r.rowspan>1||r.colspan>1){var i=n.getRowColumn(r).column,c=n.getRowColumn(r).column+r.colspan,l=n.getRowColumn(r).row,u=n.getRowColumn(r).row+r.rowspan;t>=i&&t<c&&e>=l&&e<u&&-1==p.indexOf(s)&&(p.push(s),h.push(r))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=i%n.columns;n.components[i].rowspan,n.components[i].colspan,n.components[i].get("text"),n.components[i].merged;if(c===o){for(var l=0;l<n.rows;l++)r.push(f(n.app));s.push(n.widths[o]);var u=n.columns,a=n.rows;r.reverse().forEach(function(o){0==a&&(a=n.rows,u++),a--,n.insertComponentAt(o,e+a*u)})}else{n.components[i].colspan+=1;for(var h=0;h<n.rows;h++)r.push(g(n.components[o+n.columns*h].model,n.app));s.push(n.widths[o]);var m=n.columns,d=n.rows;r.reverse().forEach(function(o){0==d&&(d=n.rows,m++),d--,n.insertComponentAt(o,e+d*m)})}var w=n.widths.slice();n.model.columns+=t.length,w.splice.apply(w,[e,0].concat(s)),n.set("widths",w)})}})}},{key:"insertCellsRight",value:function(o){var n=this,t=[];if(o.forEach(function(o){var e=n.getRowColumn(o).column;-1==t.indexOf(e)&&t.push(e)}),t.sort(function(o,n){return o-n}),t.reverse(),t.length>=2)return!1;var e=t[t.length-1]+1,s=[],r=[];t.forEach(function(o){var i=n.findMergedCellByY(o);if(0===i.length){for(var c=0;c<n.rows;c++)r.push(g(n.components[o+n.columns*c].model,n.app));s.push(n.widths[o]);var l=n.columns,u=n.rows;r.reverse().forEach(function(o){0==u&&(u=n.rows,l++),u--,n.insertComponentAt(o,e+u*l)});var a=n.widths.slice();n.model.columns+=t.length,a.splice.apply(a,[e,0].concat(s)),n.set("widths",a)}else{var h=[],p=[];i.forEach(function(o){var t,e,s;for(t=n.getRowColumn(o).column,s=(e=n.getRowColumn(o).row)*n.columns+t+1;s;){--s;var r=n.components[s];if(r.rowspan>1||r.colspan>1){var i=n.getRowColumn(r).column,c=n.getRowColumn(r).column+r.colspan,l=n.getRowColumn(r).row,u=n.getRowColumn(r).row+r.rowspan;t>=i&&t<c&&e>=l&&e<u&&-1==p.indexOf(s)&&(p.push(s),h.push(r))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=Math.floor(i/n.columns),l=i%n.columns,u=(n.components[i].rowspan,n.components[i].colspan);n.components[i].get("text"),n.components[i].merged;if(l+u-1===o){for(var a=0;a<n.rows;a++)r.push(f(n.app));s.push(n.widths[o]);var h=n.columns,m=n.rows;r.reverse().forEach(function(o){0==m&&(m=n.rows,h++),m--,n.insertComponentAt(o,e+m*h)})}else if(l===o){n.components[i].colspan+=1;for(var d=0;d<n.rows;d++)r.push(g(n.components[o+n.columns*d].model,n.app));s.push(n.widths[o]);var w=n.columns,v=n.rows;r.reverse().forEach(function(o){0==v&&(v=n.rows,w++),v--,n.insertComponentAt(o,e+v*w)}),n.components[i+c+1].rowspan=1,n.components[i+c+1].colspan=1,n.components[i+c+1].merged=!0,n.components[i+c+1].set("text","")}else{n.components[i].colspan+=1;for(var y=0;y<n.rows;y++)r.push(g(n.components[o+n.columns*y].model,n.app));s.push(n.widths[o]);var C=n.columns,b=n.rows;r.reverse().forEach(function(o){0==b&&(b=n.rows,C++),b--,n.insertComponentAt(o,e+b*C)})}var x=n.widths.slice();n.model.columns+=t.length,x.splice.apply(x,[e,0].concat(s)),n.set("widths",x)})}})}},{key:"distributeHorizontal",value:function(o){var n=this,t=[];o.forEach(function(o){var e=n.getRowColumn(o);-1==t.indexOf(e.column)&&t.push(e.column)});var e=t.reduce(function(o,t){return o+n.widths[t]},0),s=Math.round(e/t.length*100)/100,r=this.widths.slice();t.forEach(function(o){r[o]=s}),this.set("widths",r)}},{key:"distributeVertical",value:function(o){var n=this,t=[];o.forEach(function(o){var e=n.getRowColumn(o);-1==t.indexOf(e.row)&&t.push(e.row)});var e=t.reduce(function(o,t){return o+n.heights[t]},0),s=Math.round(e/t.length*100)/100,r=this.heights.slice();t.forEach(function(o){r[o]=s}),this.set("heights",r)}},{key:"toObjectArrayValue",value:function(o){if(!o||0===o.length)return null;if(!o[0].hasOwnProperty("__field1"))return o;var n={},t=[];for(var e in o[0])n[e]=o[0][e];for(var s=1;s<o.length;s++){var r={},i=o[s];for(var c in n){var l=n[c],u=i[c];r[l]=u}t.push(r)}return t}},{key:"onchange",value:function(o,n){if("rows"in o||"columns"in o){var t=this.rows,e=this.columns;this.buildCells(t,e,"rows"in n?n.rows:t,"columns"in n?n.columns:e)}"data"in o&&this.setCellsData()}},{key:"oncellchanged",value:function(o,n){("dataKey"in o||"dataIndex"in o)&&this.setCellsData()}},{key:"focusible",get:function(){return!1}},{key:"widths",get:function(){var o=this.get("widths");return o?o.length<this.columns?o.concat(O(0,this.columns-o.length)):o.length>this.columns?o.slice(0,this.columns):o:O(0,this.columns)}},{key:"heights",get:function(){var o=this.get("heights");return o?o.length<this.rows?o.concat(O(0,this.rows-o.length)):o.length>this.rows?o.slice(0,this.rows):o:O(0,this.rows)}},{key:"layout",get:function(){return m}},{key:"rows",get:function(){return Number(this.get("rows"))}},{key:"columns",get:function(){return Number(this.get("columns"))}},{key:"lefts",get:function(){var o=this;return this.components.filter(function(n,t){return!(t%o.columns)})}},{key:"centers",get:function(){var o=this;return this.components.filter(function(n,t){return t%o.columns&&(t+1)%o.columns})}},{key:"rights",get:function(){var o=this;return this.components.filter(function(n,t){return!((t+1)%o.columns)})}},{key:"tops",get:function(){return this.components.slice(0,this.columns)}},{key:"middles",get:function(){return this.components.slice(this.columns,this.columns*(this.rows-1))}},{key:"bottoms",get:function(){return this.components.slice(this.columns*(this.rows-1))}},{key:"widths_sum",get:function(){var o=this,n=this.widths;return n?n.filter(function(n,t){return t<o.columns}).reduce(function(o,n){return o+n},0):this.columns}},{key:"heights_sum",get:function(){var o=this,n=this.heights;return n?n.filter(function(n,t){return t<o.rows}).reduce(function(o,n){return o+n},0):this.rows}},{key:"nature",get:function(){return u}},{key:"controls",get:function(){var o=this.widths,n=this.heights,t=this.textBounds,e=t.width/this.widths_sum,s=t.height/this.heights_sum,r=t.left,i=t.top,c=[];return o.slice(0,this.columns-1).forEach(function(o){r+=o*e,c.push({x:r,y:t.top,handler:M})}),n.slice(0,this.rows-1).forEach(function(o){i+=o*s,c.push({x:t.left,y:i,handler:_})}),c}},{key:"eventMap",get:function(){return{"(self)":{"(descendant)":{change:this.oncellchanged}}}}}]),e}();["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(function(o){return n.Component.memoize(B.prototype,o,!1)}),n.Component.register("table",B);var A={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!0,split:!0}},{type:"string",label:"data-key",name:"dataKey",property:"dataKey"},{type:"number",label:"data-index",name:"dataIndex",property:"dataIndex"}]};var j=function(o){function e(){return t(this,e),l(this,i(e).apply(this,arguments))}return r(e,n.RectPath(n.Component)),s(e,[{key:"_drawBorder",value:function(o,t,e,s,r,i){i&&i.strokeStyle&&i.lineWidth&&i.lineDash&&(o.beginPath(),o.moveTo(t,e),o.lineTo(s,r),n.Component.drawStroke(o,i))}},{key:"_draw",value:function(o){var n=this.model,t=n.left,e=n.top,s=n.width,r=n.height,i=this.model.border||{};o.beginPath(),o.lineWidth=0,o.rect(t,e,s,r),this.drawFill(o);var c=this.parent,l=c.components.indexOf(this),u=c.columns||1,a=c.rows||1;this._drawBorder(o,t,e,t+s,e,i.top),this._drawBorder(o,t,e+r,t,e,i.left),function(o,n,t){return(o+1)%t==0}(l,0,u)&&this._drawBorder(o,t+s,e,t+s,e+r,i.right),function(o,n,t){return o>=(n-1)*t}(l,a,u)&&this._drawBorder(o,t+s,e+r,t,e+r,i.bottom)}},{key:"nature",get:function(){return A}},{key:"merged",set:function(o){this.set("merged",!!o),o&&this.set("text","")},get:function(){return this.get("merged")}},{key:"rowspan",set:function(o){this.set("rowspan",o)},get:function(){return this.get("rowspan")}},{key:"colspan",set:function(o){this.set("colspan",o)},get:function(){return this.get("colspan")}},{key:"border",get:function(){this.model.border}}]),e}();["border"].forEach(function(o){return n.Component.memoize(j.prototype,o,!1)}),n.Component.register("table-cell",j),o.Table=B,o.TableCell=j,Object.defineProperty(o,"__esModule",{value:!0})});
//# sourceMappingURL=things-scene-table.js.map
