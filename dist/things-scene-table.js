!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("@hatiolab/things-scene")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene"],s):s((t=t||self)["things-scene-table"]={},t.scene)}(this,function(t,s){"use strict";const e={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!0,split:!0}},{type:"string",label:"data-key",name:"dataKey",property:"dataKey"},{type:"number",label:"data-index",name:"dataIndex",property:"dataIndex"}]};class o extends(s.RectPath(s.Component)){get nature(){return e}set merged(t){this.set("merged",!!t),t&&this.set("text","")}get merged(){return this.get("merged")}set rowspan(t){this.set("rowspan",t)}get rowspan(){return this.get("rowspan")}set colspan(t){this.set("colspan",t)}get colspan(){return this.get("colspan")}get border(){this.model.border}_drawBorder(t,e,o,n,h,i){i&&i.strokeStyle&&i.lineWidth&&i.lineDash&&(t.beginPath(),t.moveTo(e,o),t.lineTo(n,h),s.Component.drawStroke(t,i))}_draw(t){var{left:s,top:e,width:o,height:n}=this.model,h=this.model.border||{};t.beginPath(),t.lineWidth=0,t.rect(s,e,o,n),this.drawFill(t);var i=this.parent,l=i.components.indexOf(this),r=i.columns||1,c=i.rows||1;this._drawBorder(t,s,e,s+o,e,h.top),this._drawBorder(t,s,e+n,s,e,h.left),function(t,s,e){return(t+1)%e==0}(l,0,r)&&this._drawBorder(t,s+o,e,s+o,e+n,h.right),function(t,s,e){return t>=(s-1)*e}(l,c,r)&&this._drawBorder(t,s+o,e+n,s,e+n,h.bottom)}}["border"].forEach(t=>s.Component.memoize(o.prototype,t,!1)),s.Component.register("table-cell",o);const n={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"select",label:"data-spread-to",name:"spreadTo",property:{options:["text","data"]}}]},h={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},i={strokeStyle:"",lineDash:"solid",lineWidth:0},l={strokeStyle:"#999",lineDash:"solid",lineWidth:1},r=s.Layout.get("table");function c(t,...s){for(let e in s)if(t.hasOwnProperty(s[e]))return!0}function m(t){return s.Model.compile({type:"table-cell",strokeStyle:"blue",left:0,top:0,width:1,height:1,textWrap:!0,border:u(l,"all")},t)}function p(t,e){var o=JSON.parse(JSON.stringify(t));return delete o.text,s.Model.compile(o,e)}function u(t,s){return(h[s]||[]).reduce((s,e)=>(s[e]=t,s),{})}function a(t,s,e){t&&t.set("border",Object.assign({},t.get("border")||{},u(s,e)))}function f(t,s,e,o){return 0==o||!(o%s)||-1==e.indexOf(o-1)}function g(t,s,e,o){return o==t-1||o%s==s-1||-1==e.indexOf(o+1)}function d(t,s,e,o){return o<s||-1==e.indexOf(o-s)}function w(t,s,e,o){return o>t-s-1||-1==e.indexOf(o+s)}function C(t,s){return s-t}function x(t,s){return s+t}function b(t,s){return s%t?s-1:-1}function v(t,s){return(s+1)%t?s+1:-1}function R(t,s){var e=[];for(let t=0;t<s;t++)e.push(1);return e}var y={ondragmove:function(t,s,e){var{left:o,top:n,width:h,height:i}=e.textBounds,l=e.widths_sum,r=e.widths.slice(),c=o+r.slice(0,s+1).reduce((t,s)=>t+s,0)/l*h,m=(e.transcoordP2S(t.x,t.y).x-c)/h*l,p=l/h*10;m=m<0?-Math.min(r[s]-p,-m):Math.min(r[s+1]-p,m),r[s]=Math.round(100*(r[s]+m))/100,r[s+1]=Math.round(100*(r[s+1]-m))/100,e.set("widths",r)}},E={ondragmove:function(t,s,e){var{left:o,top:n,width:h,height:i}=e.textBounds,l=e.heights_sum,r=e.heights.slice();s-=e.columns-1;var c=n+r.slice(0,s+1).reduce((t,s)=>t+s,0)/l*i,m=(e.transcoordP2S(t.x,t.y).y-c)/i*l,p=l/i*10;m=m<0?-Math.min(r[s]-p,-m):Math.min(r[s+1]-p,m),r[s]=Math.round(100*(r[s]+m))/100,r[s+1]=Math.round(100*(r[s+1]-m))/100,e.set("heights",r)}};class O extends s.Container{created(){var t=this.rows*this.columns,s=this.size()-t;if(0!=s){if(s>0){let t=this._components.slice(s);this.remove(t)}else{let t=[];for(let e=0;e<-s;e++)t.push(m(this.app));this.add(t)}var e=this.get("widths"),o=this.get("heights");(!e||e.length<this.columns)&&this.set("widths",this.widths),(!o||o.length<this.rows)&&this.set("heights",this.heights)}}get focusible(){return!1}get widths(){var t=this.get("widths");return t?t.length<this.columns?t.concat(R(0,this.columns-t.length)):t.length>this.columns?t.slice(0,this.columns):t:R(0,this.columns)}get heights(){var t=this.get("heights");return t?t.length<this.rows?t.concat(R(0,this.rows-t.length)):t.length>this.rows?t.slice(0,this.rows):t:R(0,this.rows)}buildCells(t,s,e,o){if(t<e){let s=this._components.slice(o*t),n=[];if(s.forEach(t=>{(!0===t.merged||t.rowspan>1||t.colspan>1)&&n.push(t)}),n.length>0){let s=[],h=[];n.forEach(t=>{let e,n,i;for(e=this.components.indexOf(t)%o,i=(n=Math.floor(this.components.indexOf(t)/o))*o+e+1;i;){--i;let t=this.components[i];if(t.rowspan>1||t.colspan>1){let l=this.components.indexOf(t)%o,r=this.components.indexOf(t)%o+t.colspan,c=Math.floor(this.components.indexOf(t)/o),m=Math.floor(this.components.indexOf(t)/o)+t.rowspan;e>=l&&e<r&&n>=c&&n<m&&-1==h.indexOf(i)&&(h.push(i),s.push(t))}}}),s.forEach(s=>{s.rowspan-=e-t})}this.remove(s)}var n=Math.min(t,e);if(s>o)for(let t=0;t<n;t++)for(let e=o;e<s;e++)this.insertComponentAt(m(this.app),t*s+e);else if(s<o){let t=[];for(let e=0;e<n;e++)for(let n=s;n<o;n++)t.push(this.components[e*o+n]);let e=[];if(t.forEach(t=>{(!0===t.merged||t.rowspan>1||t.colspan>1)&&e.push(t)}),e.length>0){let t=[],n=[];e.forEach(s=>{let e,h,i;for(e=this.components.indexOf(s)%o,i=(h=Math.floor(this.components.indexOf(s)/o))*o+e+1;i;){--i;let s=this.components[i];if(s.rowspan>1||s.colspan>1){let l=this.components.indexOf(s)%o,r=this.components.indexOf(s)%o+s.colspan,c=Math.floor(this.components.indexOf(s)/o),m=Math.floor(this.components.indexOf(s)/o)+s.rowspan;e>=l&&e<r&&h>=c&&h<m&&-1==n.indexOf(i)&&(n.push(i),t.push(s))}}}),t.forEach(t=>{t.colspan-=o-s})}this.remove(t)}if(t>e){let o=[];for(let n=e;n<t;n++)for(let t=0;t<s;t++)o.push(m(this.app));this.add(o)}this.set({widths:this.widths,heights:this.heights})}get layout(){return r}get rows(){return this.get("rows")}setCellsStyle(t,s,e){var o=this.components,n=o.length,h=this.get("columns"),l=[];t.forEach(t=>{if(l.push(t),t.colspan||t.rowspan){let s=this.getRowColumn(t).column,e=this.getRowColumn(t).row;for(let o=e;o<e+t.rowspan;o++)for(let n=s;n<s+t.colspan;n++)o==e&&n==s||l.push(this.components[o*this.columns+n])}});var r=l.map(t=>o.indexOf(t));r.forEach(t=>{var l=o[t];switch(e){case"all":a(l,s,e),f(0,h,r,t)&&a(o[b(h,t)],s,"right"),g(n,h,r,t)&&a(o[v(h,t)],s,"left"),d(0,h,r,t)&&a(o[C(h,t)],s,"bottom"),w(n,h,r,t)&&a(o[x(h,t)],s,"top");break;case"in":f(0,h,r,t)||a(l,s,"left"),g(n,h,r,t)||a(l,s,"right"),d(0,h,r,t)||a(l,s,"top"),w(n,h,r,t)||a(l,s,"bottom");break;case"out":f(0,h,r,t)&&(a(l,s,"left"),a(o[b(h,t)],s,"right")),g(n,h,r,t)&&(a(l,s,"right"),a(o[v(h,t)],s,"left")),d(0,h,r,t)&&(a(l,s,"top"),a(o[C(h,t)],s,"bottom")),w(n,h,r,t)&&(a(l,s,"bottom"),a(o[x(h,t)],s,"top"));break;case"left":f(0,h,r,t)&&(a(l,s,"left"),a(o[b(h,t)],s,"right"));break;case"right":g(n,h,r,t)&&(a(l,s,"right"),a(o[v(h,t)],s,"left"));break;case"center":f(0,h,r,t)||a(l,s,"left"),g(n,h,r,t)||a(l,s,"right");break;case"middle":d(0,h,r,t)||a(l,s,"top"),w(n,h,r,t)||a(l,s,"bottom");break;case"top":d(0,h,r,t)&&(a(l,s,"top"),a(o[C(h,t)],s,"bottom"));break;case"bottom":w(n,h,r,t)&&(a(l,s,"bottom"),a(o[x(h,t)],s,"top"));break;case"clear":a(l,i,"all"),f(0,h,r,t)&&a(o[b(h,t)],i,"right"),g(n,h,r,t)&&a(o[v(h,t)],i,"left"),d(0,h,r,t)&&a(o[C(h,t)],i,"bottom"),w(n,h,r,t)&&a(o[x(h,t)],i,"top")}})}setCellsData(){var t=this.data;if(t){t=this.toObjectArrayValue(t)||[];var s=this.components,{spreadTo:e="text"}=this.state;s.forEach(s=>{var o=s.model.dataKey,n=s.model.dataIndex;o&&n>=0&&(s[e]=(t[n]||{})[o])})}}getRowColumn(t){var s=this.components.indexOf(t);this.components.length;return{column:s%this.columns,row:Math.floor(s/this.columns)}}getCellsByRow(t){return this.components.slice(t*this.columns,(t+1)*this.columns)}getCellsByColumn(t){for(var s=[],e=0;e<this.rows;e++)s.push(this.components[this.columns*e+t]);return s}findMergedCellByX(t){let s,e=[];for(let o=0;o<this.columns;o++)(!0===(s=this.components[t*this.columns+o]).merged||s.rowspan>1||s.colspan>1)&&e.push(s);return e}findMergedCellByY(t){let s,e=[];for(let o=0;o<this.rows;o++)(!0===(s=this.components[o*this.columns+t]).merged||s.rowspan>1||s.colspan>1)&&e.push(s);return e}mergeCells(t){let s=[];if(t.forEach(t=>{let e=this.getRowColumn(t).row;-1==s.indexOf(e)&&s.push(e)}),s.length-1!=s[s.length-1]-s[0])return!1;let e=[];if(t.forEach(t=>{let s=this.getRowColumn(t).column;-1==e.indexOf(s)&&e.push(s)}),e.length-1!=e[e.length-1]-e[0])return!1;let o=s.length,n=e.length,h=t.length;if(h!==o*n||h<2)return!1;t.sort((t,s)=>this.getRowColumn(t).row*this.columns+this.getRowColumn(t).column-(this.getRowColumn(s).row*this.columns+this.getRowColumn(s).column));let i=t[0];i.set({colspan:n,rowspan:o});for(let s=1;s<h;s++)t[s].merged=!0;this.root.selected=[i]}splitCells(t){this.getRowColumn(t[0]);let s=t[0],e=this.components.indexOf(t[0]),o=this.components.length,n=this.components[o-1],h=o/(this.getRowColumn(n).row+1);for(let t=0;t<s.rowspan;t++){let o,n;for(let i=e;i<e+s.colspan;i++)o=h*t+i,(n=this.components[o]).merged=!1}s.colspan=1,s.rowspan=1}deleteRows(t){if(1==t[0].merged)return!1;let s=[];t.forEach(t=>{let e=this.getRowColumn(t).row;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse();var e=this.heights.slice();s.forEach(t=>{let s=this.findMergedCellByX(t);if(0===s.length)this.remove(this.getCellsByRow(t));else{let e=[];s.forEach(t=>{let s,o,n;for(s=this.getRowColumn(t).column,n=(o=this.getRowColumn(t).row)*this.columns+s+1;n;){--n;let t=this.components[n];if(t.rowspan>1||t.colspan>1){let h=this.getRowColumn(t).column,i=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;s>=h&&s<i&&o>=l&&o<r&&-1==e.indexOf(n)&&e.push(n)}}}),e.forEach(s=>{let e=Math.floor(s/this.columns);t===e&&e!==this.rows-1&&this.components[s].rowspan>1?(this.components[s+this.columns].rowspan=this.components[s].rowspan-1,this.components[s+this.columns].colspan=this.components[s].colspan,this.components[s+this.columns].merged=!1,this.components[s+this.columns].set("text",this.components[s].get("text"))):this.components[s].rowspan-=1}),this.remove(this.getCellsByRow(t))}}),e.splice(s,1),this.model.rows-=s.length,this.set("heights",e)}deleteColumns(t){if(1==t[0].merged)return!1;let s=[];t.forEach(t=>{let e=this.getRowColumn(t).column;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse(),s.forEach(t=>{var s=this.widths.slice();let e=this.findMergedCellByY(t);if(0===e.length)this.remove(this.getCellsByColumn(t));else{let s=[];e.forEach(t=>{let e,o,n;for(e=this.getRowColumn(t).column,n=(o=this.getRowColumn(t).row)*this.columns+e+1;n;){--n;let t=this.components[n];if(t.rowspan>1||t.colspan>1){let h=this.getRowColumn(t).column,i=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;e>=h&&e<i&&o>=l&&o<r&&-1==s.indexOf(n)&&s.push(n)}}}),s.forEach(s=>{let e=s%this.columns;t===e&&e!==this.columns-1&&this.components[s].colspan>1?(this.components[s+1].rowspan=this.components[s].rowspan,this.components[s+1].colspan=this.components[s].colspan-1,this.components[s+1].merged=!1,this.components[s+1].set("text",this.components[s].get("text"))):this.components[s].colspan-=1}),this.remove(this.getCellsByColumn(t))}s.splice(t,1),this.model.columns-=1,this.set("widths",s)})}insertCellsAbove(t){let s=[];if(t.forEach(t=>{let e=this.getRowColumn(t).row;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse(),s.length>=2)return!1;let e=s[0],o=[],n=[];s.forEach(t=>{let h=this.findMergedCellByX(t);if(0===h.length){for(let s=0;s<this.columns;s++)n.push(p(this.components[t*this.columns+s].model,this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)});let h=this.heights.slice();h.splice(e,0,...o),this.set("heights",h),this.model.rows+=s.length,this.clearCache()}else{if(s.length>1)return!1;let i=[];h.forEach(t=>{let s,e,o;for(s=this.getRowColumn(t).column,o=(e=this.getRowColumn(t).row)*this.columns+s+1;o;){--o;let t=this.components[o];if(t.rowspan>1||t.colspan>1){let n=this.getRowColumn(t).column,h=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;s>=n&&s<h&&e>=l&&e<r&&-1==i.indexOf(o)&&i.push(o)}}}),i.forEach(h=>{if(i.length>=2)return!1;let l=Math.floor(h/this.columns),r={rowspan:this.components[h].rowspan,colspan:this.components[h].colspan,text:this.components[h].get("text"),merged:this.components[h].merged};if(l===t){for(let t=0;t<this.columns;t++)n.push(m(this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)}),this.components[h+this.columns].rowspan=r.rowspan,this.components[h+this.columns].colspan=r.colspan,this.components[h+this.columns].set("text",r.text),this.components[h+this.columns].merged=r.merged}else{for(let s=0;s<this.columns;s++)n.push(p(this.components[t*this.columns+s].model,this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)}),this.components[h].rowspan+=1}let c=this.heights.slice();c.splice(e,0,...o),this.set("heights",c),this.model.rows+=s.length,this.clearCache()})}})}insertCellsBelow(t){let s=[];if(t.forEach(t=>{let e=this.getRowColumn(t).row;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse(),s.length>=2)return!1;let e=s[s.length-1]+1,o=[],n=[];s.forEach(t=>{let s=this.findMergedCellByX(t);if(0===s.length){for(let s=0;s<this.columns;s++)n.push(p(this.components[t*this.columns+s].model,this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)});let s=this.heights.slice();s.splice(e,0,...o),this.set("heights",s),this.model.rows+=1,this.clearCache()}else{let h=[];s.forEach(t=>{let s,e,o;for(s=this.getRowColumn(t).column,o=(e=this.getRowColumn(t).row)*this.columns+s+1;o;){--o;let t=this.components[o];if(t.rowspan>1||t.colspan>1){let n=this.getRowColumn(t).column,i=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;s>=n&&s<i&&e>=l&&e<r&&-1==h.indexOf(o)&&h.push(o)}}}),h.forEach(s=>{if(h.length>=2)return!1;let i=Math.floor(s/this.columns),l=this.components[s].rowspan;this.components[s].colspan,this.components[s].get("text"),this.components[s].merged;if(i+l-1===t){for(let t=0;t<this.columns;t++)n.push(m(this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)})}else if(i===t){for(let s=0;s<this.columns;s++)n.push(p(this.components[t*this.columns+s].model,this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)}),this.components[s].rowspan+=1,this.components[s+this.columns].rowspan=1,this.components[s+this.columns].colspan=1,this.components[s+this.columns].merged=!0,this.components[s+this.columns].set("text","")}else{for(let s=0;s<this.columns;s++)n.push(p(this.components[t*this.columns+s].model,this.app));o.push(this.heights[t]),n.reverse().forEach(t=>{this.insertComponentAt(t,e*this.columns)}),this.components[s].rowspan+=1}let r=this.heights.slice();r.splice(e,0,...o),this.set("heights",r),this.model.rows+=1,this.clearCache()})}})}insertCellsLeft(t){let s=[];if(t.forEach(t=>{let e=this.getRowColumn(t).column;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse(),s.length>=2)return!1;let e=s[0],o=[],n=[];s.forEach(t=>{let h=this.findMergedCellByY(t);if(0===h.length){for(let s=0;s<this.rows;s++)n.push(p(this.components[t+this.columns*s].model,this.app));o.push(this.widths[t]);let h=this.columns,i=this.rows;n.reverse().forEach(t=>{0==i&&(i=this.rows,h++),i--,this.insertComponentAt(t,e+i*h)});let l=this.widths.slice();this.model.columns+=s.length,l.splice(e,0,...o),this.set("widths",l)}else{let i=[];h.forEach(t=>{let s,e,o;for(s=this.getRowColumn(t).column,o=(e=this.getRowColumn(t).row)*this.columns+s+1;o;){--o;let t=this.components[o];if(t.rowspan>1||t.colspan>1){let n=this.getRowColumn(t).column,h=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;s>=n&&s<h&&e>=l&&e<r&&-1==i.indexOf(o)&&i.push(o)}}}),i.forEach(h=>{if(i.length>=2)return!1;let l=h%this.columns;this.components[h].rowspan,this.components[h].colspan,this.components[h].get("text"),this.components[h].merged;if(l===t){for(let t=0;t<this.rows;t++)n.push(m(this.app));o.push(this.widths[t]);let s=this.columns,h=this.rows;n.reverse().forEach(t=>{0==h&&(h=this.rows,s++),h--,this.insertComponentAt(t,e+h*s)})}else{this.components[h].colspan+=1;for(let s=0;s<this.rows;s++)n.push(p(this.components[t+this.columns*s].model,this.app));o.push(this.widths[t]);let s=this.columns,i=this.rows;n.reverse().forEach(t=>{0==i&&(i=this.rows,s++),i--,this.insertComponentAt(t,e+i*s)})}let r=this.widths.slice();this.model.columns+=s.length,r.splice(e,0,...o),this.set("widths",r)})}})}insertCellsRight(t){let s=[];if(t.forEach(t=>{let e=this.getRowColumn(t).column;-1==s.indexOf(e)&&s.push(e)}),s.sort((t,s)=>t-s),s.reverse(),s.length>=2)return!1;let e=s[s.length-1]+1,o=[],n=[];s.forEach(t=>{let h=this.findMergedCellByY(t);if(0===h.length){for(let s=0;s<this.rows;s++)n.push(p(this.components[t+this.columns*s].model,this.app));o.push(this.widths[t]);let h=this.columns,i=this.rows;n.reverse().forEach(t=>{0==i&&(i=this.rows,h++),i--,this.insertComponentAt(t,e+i*h)});let l=this.widths.slice();this.model.columns+=s.length,l.splice(e,0,...o),this.set("widths",l)}else{let i=[];h.forEach(t=>{let s,e,o;for(s=this.getRowColumn(t).column,o=(e=this.getRowColumn(t).row)*this.columns+s+1;o;){--o;let t=this.components[o];if(t.rowspan>1||t.colspan>1){let n=this.getRowColumn(t).column,h=this.getRowColumn(t).column+t.colspan,l=this.getRowColumn(t).row,r=this.getRowColumn(t).row+t.rowspan;s>=n&&s<h&&e>=l&&e<r&&-1==i.indexOf(o)&&i.push(o)}}}),i.forEach(h=>{if(i.length>=2)return!1;let l=Math.floor(h/this.columns),r=h%this.columns,c=(this.components[h].rowspan,this.components[h].colspan);this.components[h].get("text"),this.components[h].merged;if(r+c-1===t){for(let t=0;t<this.rows;t++)n.push(m(this.app));o.push(this.widths[t]);let s=this.columns,h=this.rows;n.reverse().forEach(t=>{0==h&&(h=this.rows,s++),h--,this.insertComponentAt(t,e+h*s)})}else if(r===t){this.components[h].colspan+=1;for(let s=0;s<this.rows;s++)n.push(p(this.components[t+this.columns*s].model,this.app));o.push(this.widths[t]);let s=this.columns,i=this.rows;n.reverse().forEach(t=>{0==i&&(i=this.rows,s++),i--,this.insertComponentAt(t,e+i*s)}),this.components[h+l+1].rowspan=1,this.components[h+l+1].colspan=1,this.components[h+l+1].merged=!0,this.components[h+l+1].set("text","")}else{this.components[h].colspan+=1;for(let s=0;s<this.rows;s++)n.push(p(this.components[t+this.columns*s].model,this.app));o.push(this.widths[t]);let s=this.columns,i=this.rows;n.reverse().forEach(t=>{0==i&&(i=this.rows,s++),i--,this.insertComponentAt(t,e+i*s)})}let u=this.widths.slice();this.model.columns+=s.length,u.splice(e,0,...o),this.set("widths",u)})}})}distributeHorizontal(t){var s=[];t.forEach(t=>{let e=this.getRowColumn(t);-1==s.indexOf(e.column)&&s.push(e.column)});var e=s.reduce((t,s)=>t+this.widths[s],0),o=Math.round(e/s.length*100)/100,n=this.widths.slice();s.forEach(t=>{n[t]=o}),this.set("widths",n)}distributeVertical(t){var s=[];t.forEach(t=>{let e=this.getRowColumn(t);-1==s.indexOf(e.row)&&s.push(e.row)});var e=s.reduce((t,s)=>t+this.heights[s],0),o=Math.round(e/s.length*100)/100,n=this.heights.slice();s.forEach(t=>{n[t]=o}),this.set("heights",n)}toObjectArrayValue(t){if(!t||0===t.length)return null;if(!t[0].hasOwnProperty("__field1"))return t;let s={},e=[];for(let e in t[0])s[e]=t[0][e];for(var o=1;o<t.length;o++){let n={},h=t[o];for(let t in s){let e=s[t],o=h[t];n[e]=o}e.push(n)}return e}get columns(){return this.get("columns")}get lefts(){return this.components.filter((t,s)=>!(s%this.columns))}get centers(){return this.components.filter((t,s)=>s%this.columns&&(s+1)%this.columns)}get rights(){return this.components.filter((t,s)=>!((s+1)%this.columns))}get tops(){return this.components.slice(0,this.columns)}get middles(){return this.components.slice(this.columns,this.columns*(this.rows-1))}get bottoms(){return this.components.slice(this.columns*(this.rows-1))}get all(){return this.components}get widths_sum(){var t=this.widths;return t?t.filter((t,s)=>s<this.columns).reduce((t,s)=>t+s,0):this.columns}get heights_sum(){var t=this.heights;return t?t.filter((t,s)=>s<this.rows).reduce((t,s)=>t+s,0):this.rows}get nature(){return n}get controls(){var t=this.widths,s=this.heights,e=this.textBounds,o=e.width/this.widths_sum,n=e.height/this.heights_sum,h=e.left,i=e.top,l=[];return t.slice(0,this.columns-1).forEach(t=>{h+=t*o,l.push({x:h,y:e.top,handler:y})}),s.slice(0,this.rows-1).forEach(t=>{i+=t*n,l.push({x:e.left,y:i,handler:E})}),l}onchange(t,s){c(t,"rows","columns")&&this.buildCells(this.get("rows"),this.get("columns"),s.hasOwnProperty("rows")?s.rows:this.get("rows"),s.hasOwnProperty("columns")?s.columns:this.get("columns")),(s.data||t.data)&&this.setCellsData()}get eventMap(){return{"(self)":{"(descendant)":{change:this.oncellchanged}}}}oncellchanged(t,s){c(t,"dataKey","dataIndex")&&this.setCellsData()}}["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(t=>s.Component.memoize(O.prototype,t,!1)),s.Component.register("table",O),t.Table=O,Object.defineProperty(t,"__esModule",{value:!0})});
