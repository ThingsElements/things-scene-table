!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@hatiolab/things-scene"),require("lit-element")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene","lit-element"],e):e((n=n||self)["things-scene-table"]={},n.scene,n.litElement)}(this,function(n,e,t){"use strict";function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function s(n,e,t){return e&&r(n.prototype,e),t&&r(n,t),n}function i(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&u(n,e)}function c(n){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function u(n,e){return(u=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n})(n,e)}function l(n,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n):e}function a(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}var h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"rows",name:"rows",property:"rows"},{type:"number",label:"columns",name:"columns",property:"columns"},{type:"select",label:"data-spread-to",name:"spreadTo",property:{options:["text","data"]}}],"value-property":"data"},p={all:["top","left","bottom","right"],out:["top","left","bottom","right"],left:["left"],right:["right"],top:["top"],bottom:["bottom"],leftright:["left","right"],topbottom:["top","bottom"]},f={strokeStyle:"",lineDash:"solid",lineWidth:0},m={strokeStyle:"#999",lineDash:"solid",lineWidth:1},d=e.Layout.get("table");function g(n){return e.Model.compile({type:"table-cell",strokeStyle:"blue",left:0,top:0,width:1,height:1,textWrap:!0,border:v(m,"all")},n)}function w(n,t){var o=JSON.parse(JSON.stringify(n));return delete o.text,e.Model.compile(o,t)}function v(n,e){return(p[e]||[]).reduce(function(e,t){return e[t]=n,e},{})}function y(n,e,t){n&&n.set("border",Object.assign({},n.get("border")||{},v(e,t)))}function C(n,e,t,o){return 0==o||!(o%e)||-1==t.indexOf(o-1)}function b(n,e,t,o){return o==n-1||o%e==e-1||-1==t.indexOf(o+1)}function x(n,e,t,o){return o<e||-1==t.indexOf(o-e)}function k(n,e,t,o){return o>n-e-1||-1==t.indexOf(o+e)}function E(n,e){return e-n}function R(n,e){return e+n}function O(n,e){return e%n?e-1:-1}function M(n,e){return(e+1)%n?e+1:-1}function _(n,e){for(var t=[],o=0;o<e;o++)t.push(1);return t}var B={ondragmove:function(n,e,t){var o=t.textBounds,r=o.left,s=(o.top,o.width),i=(o.height,t.widths_sum),c=t.widths.slice(),u=r+c.slice(0,e+1).reduce(function(n,e){return n+e},0)/i*s,l=(t.transcoordP2S(n.x,n.y).x-u)/s*i,a=i/s*10;l=l<0?-Math.min(c[e]-a,-l):Math.min(c[e+1]-a,l),c[e]=Math.round(100*(c[e]+l))/100,c[e+1]=Math.round(100*(c[e+1]-l))/100,t.set("widths",c)}},A={ondragmove:function(n,e,t){var o=t.textBounds,r=(o.left,o.top),s=(o.width,o.height),i=t.heights_sum,c=t.heights.slice();e-=t.columns-1;var u=r+c.slice(0,e+1).reduce(function(n,e){return n+e},0)/i*s,l=(t.transcoordP2S(n.x,n.y).y-u)/s*i,a=i/s*10;l=l<0?-Math.min(c[e]-a,-l):Math.min(c[e+1]-a,l),c[e]=Math.round(100*(c[e]+l))/100,c[e+1]=Math.round(100*(c[e+1]-l))/100,t.set("heights",c)}},j=function(n){function t(){return o(this,t),l(this,c(t).apply(this,arguments))}return i(t,e.Container),s(t,[{key:"created",value:function(){var n=this.rows*this.columns,e=this.size()-n;if(0!=e){if(e>0){var t=this._components.slice(e);this.remove(t)}else{for(var o=[],r=0;r<-e;r++)o.push(g(this.app));this.add(o)}var s=this.get("widths"),i=this.get("heights");(!s||s.length<this.columns)&&this.set("widths",this.widths),(!i||i.length<this.rows)&&this.set("heights",this.heights)}}},{key:"buildCells",value:function(n,e,t,o){var r=this;if(n<t){var s=this._components.slice(o*n),i=[];if(s.forEach(function(n){(!0===n.merged||n.rowspan>1||n.colspan>1)&&i.push(n)}),i.length>0){var c=[],u=[];i.forEach(function(n){var e,t,s;for(e=r.components.indexOf(n)%o,s=(t=Math.floor(r.components.indexOf(n)/o))*o+e+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var l=r.components.indexOf(i)%o,a=r.components.indexOf(i)%o+i.colspan,h=Math.floor(r.components.indexOf(i)/o),p=Math.floor(r.components.indexOf(i)/o)+i.rowspan;e>=l&&e<a&&t>=h&&t<p&&-1==u.indexOf(s)&&(u.push(s),c.push(i))}}}),c.forEach(function(e){e.rowspan-=t-n})}this.remove(s)}var l=Math.min(n,t);if(e>o)for(var a=0;a<l;a++)for(var h=o;h<e;h++)this.insertComponentAt(g(this.app),a*e+h);else if(e<o){for(var p=[],f=0;f<l;f++)for(var m=e;m<o;m++)p.push(this.components[f*o+m]);var d=[];if(p.forEach(function(n){(!0===n.merged||n.rowspan>1||n.colspan>1)&&d.push(n)}),d.length>0){var w=[],v=[];d.forEach(function(n){var e,t,s;for(e=r.components.indexOf(n)%o,s=(t=Math.floor(r.components.indexOf(n)/o))*o+e+1;s;){--s;var i=r.components[s];if(i.rowspan>1||i.colspan>1){var c=r.components.indexOf(i)%o,u=r.components.indexOf(i)%o+i.colspan,l=Math.floor(r.components.indexOf(i)/o),a=Math.floor(r.components.indexOf(i)/o)+i.rowspan;e>=c&&e<u&&t>=l&&t<a&&-1==v.indexOf(s)&&(v.push(s),w.push(i))}}}),w.forEach(function(n){n.colspan-=o-e})}this.remove(p)}if(n>t){for(var y=[],C=t;C<n;C++)for(var b=0;b<e;b++)y.push(g(this.app));this.add(y)}this.set({widths:this.widths,heights:this.heights})}},{key:"setCellsStyle",value:function(n,e,t){var o=this,r=this.components,s=r.length,i=this.get("columns"),c=[];n.forEach(function(n){if(c.push(n),n.colspan||n.rowspan)for(var e=o.getRowColumn(n).column,t=o.getRowColumn(n).row,r=t;r<t+n.rowspan;r++)for(var s=e;s<e+n.colspan;s++)r==t&&s==e||c.push(o.components[r*o.columns+s])});var u=c.map(function(n){return r.indexOf(n)});u.forEach(function(n){var o=r[n];switch(t){case"all":y(o,e,t),C(0,i,u,n)&&y(r[O(i,n)],e,"right"),b(s,i,u,n)&&y(r[M(i,n)],e,"left"),x(0,i,u,n)&&y(r[E(i,n)],e,"bottom"),k(s,i,u,n)&&y(r[R(i,n)],e,"top");break;case"in":C(0,i,u,n)||y(o,e,"left"),b(s,i,u,n)||y(o,e,"right"),x(0,i,u,n)||y(o,e,"top"),k(s,i,u,n)||y(o,e,"bottom");break;case"out":C(0,i,u,n)&&(y(o,e,"left"),y(r[O(i,n)],e,"right")),b(s,i,u,n)&&(y(o,e,"right"),y(r[M(i,n)],e,"left")),x(0,i,u,n)&&(y(o,e,"top"),y(r[E(i,n)],e,"bottom")),k(s,i,u,n)&&(y(o,e,"bottom"),y(r[R(i,n)],e,"top"));break;case"left":C(0,i,u,n)&&(y(o,e,"left"),y(r[O(i,n)],e,"right"));break;case"right":b(s,i,u,n)&&(y(o,e,"right"),y(r[M(i,n)],e,"left"));break;case"center":C(0,i,u,n)||y(o,e,"left"),b(s,i,u,n)||y(o,e,"right");break;case"middle":x(0,i,u,n)||y(o,e,"top"),k(s,i,u,n)||y(o,e,"bottom");break;case"top":x(0,i,u,n)&&(y(o,e,"top"),y(r[E(i,n)],e,"bottom"));break;case"bottom":k(s,i,u,n)&&(y(o,e,"bottom"),y(r[R(i,n)],e,"top"));break;case"clear":y(o,f,"all"),C(0,i,u,n)&&y(r[O(i,n)],f,"right"),b(s,i,u,n)&&y(r[M(i,n)],f,"left"),x(0,i,u,n)&&y(r[E(i,n)],f,"bottom"),k(s,i,u,n)&&y(r[R(i,n)],f,"top")}})}},{key:"setCellsData",value:function(){var n=this.data;if(n){n=this.toObjectArrayValue(n)||[];var e=this.components,t=this.state.spreadTo,o=void 0===t?"text":t;e.forEach(function(e){var t=e.model.dataKey,r=e.model.dataIndex;t&&r>=0&&(e[o]=(n[r]||{})[t])})}}},{key:"getRowColumn",value:function(n){var e=this.components.indexOf(n);this.components.length;return{column:e%this.columns,row:Math.floor(e/this.columns)}}},{key:"getCellsByRow",value:function(n){return this.components.slice(n*this.columns,(n+1)*this.columns)}},{key:"getCellsByColumn",value:function(n){for(var e=[],t=0;t<this.rows;t++)e.push(this.components[this.columns*t+n]);return e}},{key:"findMergedCellByX",value:function(n){for(var e,t=[],o=0;o<this.columns;o++)(!0===(e=this.components[n*this.columns+o]).merged||e.rowspan>1||e.colspan>1)&&t.push(e);return t}},{key:"findMergedCellByY",value:function(n){for(var e,t=[],o=0;o<this.rows;o++)(!0===(e=this.components[o*this.columns+n]).merged||e.rowspan>1||e.colspan>1)&&t.push(e);return t}},{key:"mergeCells",value:function(n){var e=this,t=[];if(n.forEach(function(n){var o=e.getRowColumn(n).row;-1==t.indexOf(o)&&t.push(o)}),t.length-1!=t[t.length-1]-t[0])return!1;var o=[];if(n.forEach(function(n){var t=e.getRowColumn(n).column;-1==o.indexOf(t)&&o.push(t)}),o.length-1!=o[o.length-1]-o[0])return!1;var r=t.length,s=o.length,i=n.length;if(i!==r*s||i<2)return!1;n.sort(function(n,t){return e.getRowColumn(n).row*e.columns+e.getRowColumn(n).column-(e.getRowColumn(t).row*e.columns+e.getRowColumn(t).column)});var c=n[0];c.set({colspan:s,rowspan:r});for(var u=1;u<i;u++)n[u].merged=!0;this.root.selected=[c]}},{key:"splitCells",value:function(n){this.getRowColumn(n[0]);for(var e=n[0],t=this.components.indexOf(n[0]),o=this.components.length,r=this.components[o-1],s=o/(this.getRowColumn(r).row+1),i=0;i<e.rowspan;i++)for(var c=void 0,u=t;u<t+e.colspan;u++)c=s*i+u,this.components[c].merged=!1;e.colspan=1,e.rowspan=1}},{key:"deleteRows",value:function(n){var e=this;if(1==n[0].merged)return!1;var t=[];n.forEach(function(n){var o=e.getRowColumn(n).row;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse();var o=this.heights.slice();t.forEach(function(n){var t=e.findMergedCellByX(n);if(0===t.length)e.remove(e.getCellsByRow(n));else{var o=[],r=[];t.forEach(function(n){var t,s,i;for(t=e.getRowColumn(n).column,i=(s=e.getRowColumn(n).row)*e.columns+t+1;i;){--i;var c=e.components[i];if(c.rowspan>1||c.colspan>1){var u=e.getRowColumn(c).column,l=e.getRowColumn(c).column+c.colspan,a=e.getRowColumn(c).row,h=e.getRowColumn(c).row+c.rowspan;t>=u&&t<l&&s>=a&&s<h&&-1==r.indexOf(i)&&(r.push(i),o.push(c))}}}),r.forEach(function(t){var o=Math.floor(t/e.columns);n===o&&o!==e.rows-1&&e.components[t].rowspan>1?(e.components[t+e.columns].rowspan=e.components[t].rowspan-1,e.components[t+e.columns].colspan=e.components[t].colspan,e.components[t+e.columns].merged=!1,e.components[t+e.columns].set("text",e.components[t].get("text"))):e.components[t].rowspan-=1}),e.remove(e.getCellsByRow(n))}}),o.splice(t,1),this.model.rows-=t.length,this.set("heights",o)}},{key:"deleteColumns",value:function(n){var e=this;if(1==n[0].merged)return!1;var t=[];n.forEach(function(n){var o=e.getRowColumn(n).column;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse(),t.forEach(function(n){var t=e.widths.slice(),o=e.findMergedCellByY(n);if(0===o.length)e.remove(e.getCellsByColumn(n));else{var r=[],s=[];o.forEach(function(n){var t,o,i;for(t=e.getRowColumn(n).column,i=(o=e.getRowColumn(n).row)*e.columns+t+1;i;){--i;var c=e.components[i];if(c.rowspan>1||c.colspan>1){var u=e.getRowColumn(c).column,l=e.getRowColumn(c).column+c.colspan,a=e.getRowColumn(c).row,h=e.getRowColumn(c).row+c.rowspan;t>=u&&t<l&&o>=a&&o<h&&-1==s.indexOf(i)&&(s.push(i),r.push(c))}}}),s.forEach(function(t){var o=t%e.columns;n===o&&o!==e.columns-1&&e.components[t].colspan>1?(e.components[t+1].rowspan=e.components[t].rowspan,e.components[t+1].colspan=e.components[t].colspan-1,e.components[t+1].merged=!1,e.components[t+1].set("text",e.components[t].get("text"))):e.components[t].colspan-=1}),e.remove(e.getCellsByColumn(n))}t.splice(n,1),e.model.columns-=1,e.set("widths",t)})}},{key:"insertCellsAbove",value:function(n){var e=this,t=[];if(n.forEach(function(n){var o=e.getRowColumn(n).row;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse(),t.length>=2)return!1;var o=t[0],r=[],s=[];t.forEach(function(n){var i=e.findMergedCellByX(n);if(0===i.length){for(var c=0;c<e.columns;c++)s.push(w(e.components[n*e.columns+c].model,e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)});var u=e.heights.slice();u.splice.apply(u,[o,0].concat(r)),e.set("heights",u),e.model.rows+=t.length,e.clearCache()}else{if(t.length>1)return!1;var l=[],a=[];i.forEach(function(n){var t,o,r;for(t=e.getRowColumn(n).column,r=(o=e.getRowColumn(n).row)*e.columns+t+1;r;){--r;var s=e.components[r];if(s.rowspan>1||s.colspan>1){var i=e.getRowColumn(s).column,c=e.getRowColumn(s).column+s.colspan,u=e.getRowColumn(s).row,h=e.getRowColumn(s).row+s.rowspan;t>=i&&t<c&&o>=u&&o<h&&-1==a.indexOf(r)&&(a.push(r),l.push(s))}}}),a.forEach(function(i){if(a.length>=2)return!1;var c=Math.floor(i/e.columns),u={rowspan:e.components[i].rowspan,colspan:e.components[i].colspan,text:e.components[i].get("text"),merged:e.components[i].merged};if(c===n){for(var l=0;l<e.columns;l++)s.push(g(e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)}),e.components[i+e.columns].rowspan=u.rowspan,e.components[i+e.columns].colspan=u.colspan,e.components[i+e.columns].set("text",u.text),e.components[i+e.columns].merged=u.merged}else{for(var h=0;h<e.columns;h++)s.push(w(e.components[n*e.columns+h].model,e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)}),e.components[i].rowspan+=1}var p=e.heights.slice();p.splice.apply(p,[o,0].concat(r)),e.set("heights",p),e.model.rows+=t.length,e.clearCache()})}})}},{key:"insertCellsBelow",value:function(n){var e=this,t=[];if(n.forEach(function(n){var o=e.getRowColumn(n).row;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse(),t.length>=2)return!1;var o=t[t.length-1]+1,r=[],s=[];t.forEach(function(n){var t=e.findMergedCellByX(n);if(0===t.length){for(var i=0;i<e.columns;i++)s.push(w(e.components[n*e.columns+i].model,e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)});var c=e.heights.slice();c.splice.apply(c,[o,0].concat(r)),e.set("heights",c),e.model.rows+=1,e.clearCache()}else{var u=[],l=[];t.forEach(function(n){var t,o,r;for(t=e.getRowColumn(n).column,r=(o=e.getRowColumn(n).row)*e.columns+t+1;r;){--r;var s=e.components[r];if(s.rowspan>1||s.colspan>1){var i=e.getRowColumn(s).column,c=e.getRowColumn(s).column+s.colspan,a=e.getRowColumn(s).row,h=e.getRowColumn(s).row+s.rowspan;t>=i&&t<c&&o>=a&&o<h&&-1==l.indexOf(r)&&(l.push(r),u.push(s))}}}),l.forEach(function(t){if(l.length>=2)return!1;var i=Math.floor(t/e.columns),c=e.components[t].rowspan;e.components[t].colspan,e.components[t].get("text"),e.components[t].merged;if(i+c-1===n){for(var u=0;u<e.columns;u++)s.push(g(e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)})}else if(i===n){for(var a=0;a<e.columns;a++)s.push(w(e.components[n*e.columns+a].model,e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)}),e.components[t].rowspan+=1,e.components[t+e.columns].rowspan=1,e.components[t+e.columns].colspan=1,e.components[t+e.columns].merged=!0,e.components[t+e.columns].set("text","")}else{for(var h=0;h<e.columns;h++)s.push(w(e.components[n*e.columns+h].model,e.app));r.push(e.heights[n]),s.reverse().forEach(function(n){e.insertComponentAt(n,o*e.columns)}),e.components[t].rowspan+=1}var p=e.heights.slice();p.splice.apply(p,[o,0].concat(r)),e.set("heights",p),e.model.rows+=1,e.clearCache()})}})}},{key:"insertCellsLeft",value:function(n){var e=this,t=[];if(n.forEach(function(n){var o=e.getRowColumn(n).column;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse(),t.length>=2)return!1;var o=t[0],r=[],s=[];t.forEach(function(n){var i=e.findMergedCellByY(n);if(0===i.length){for(var c=0;c<e.rows;c++)s.push(w(e.components[n+e.columns*c].model,e.app));r.push(e.widths[n]);var u=e.columns,l=e.rows;s.reverse().forEach(function(n){0==l&&(l=e.rows,u++),l--,e.insertComponentAt(n,o+l*u)});var a=e.widths.slice();e.model.columns+=t.length,a.splice.apply(a,[o,0].concat(r)),e.set("widths",a)}else{var h=[],p=[];i.forEach(function(n){var t,o,r;for(t=e.getRowColumn(n).column,r=(o=e.getRowColumn(n).row)*e.columns+t+1;r;){--r;var s=e.components[r];if(s.rowspan>1||s.colspan>1){var i=e.getRowColumn(s).column,c=e.getRowColumn(s).column+s.colspan,u=e.getRowColumn(s).row,l=e.getRowColumn(s).row+s.rowspan;t>=i&&t<c&&o>=u&&o<l&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=i%e.columns;e.components[i].rowspan,e.components[i].colspan,e.components[i].get("text"),e.components[i].merged;if(c===n){for(var u=0;u<e.rows;u++)s.push(g(e.app));r.push(e.widths[n]);var l=e.columns,a=e.rows;s.reverse().forEach(function(n){0==a&&(a=e.rows,l++),a--,e.insertComponentAt(n,o+a*l)})}else{e.components[i].colspan+=1;for(var h=0;h<e.rows;h++)s.push(w(e.components[n+e.columns*h].model,e.app));r.push(e.widths[n]);var f=e.columns,m=e.rows;s.reverse().forEach(function(n){0==m&&(m=e.rows,f++),m--,e.insertComponentAt(n,o+m*f)})}var d=e.widths.slice();e.model.columns+=t.length,d.splice.apply(d,[o,0].concat(r)),e.set("widths",d)})}})}},{key:"insertCellsRight",value:function(n){var e=this,t=[];if(n.forEach(function(n){var o=e.getRowColumn(n).column;-1==t.indexOf(o)&&t.push(o)}),t.sort(function(n,e){return n-e}),t.reverse(),t.length>=2)return!1;var o=t[t.length-1]+1,r=[],s=[];t.forEach(function(n){var i=e.findMergedCellByY(n);if(0===i.length){for(var c=0;c<e.rows;c++)s.push(w(e.components[n+e.columns*c].model,e.app));r.push(e.widths[n]);var u=e.columns,l=e.rows;s.reverse().forEach(function(n){0==l&&(l=e.rows,u++),l--,e.insertComponentAt(n,o+l*u)});var a=e.widths.slice();e.model.columns+=t.length,a.splice.apply(a,[o,0].concat(r)),e.set("widths",a)}else{var h=[],p=[];i.forEach(function(n){var t,o,r;for(t=e.getRowColumn(n).column,r=(o=e.getRowColumn(n).row)*e.columns+t+1;r;){--r;var s=e.components[r];if(s.rowspan>1||s.colspan>1){var i=e.getRowColumn(s).column,c=e.getRowColumn(s).column+s.colspan,u=e.getRowColumn(s).row,l=e.getRowColumn(s).row+s.rowspan;t>=i&&t<c&&o>=u&&o<l&&-1==p.indexOf(r)&&(p.push(r),h.push(s))}}}),p.forEach(function(i){if(p.length>=2)return!1;var c=Math.floor(i/e.columns),u=i%e.columns,l=(e.components[i].rowspan,e.components[i].colspan);e.components[i].get("text"),e.components[i].merged;if(u+l-1===n){for(var a=0;a<e.rows;a++)s.push(g(e.app));r.push(e.widths[n]);var h=e.columns,f=e.rows;s.reverse().forEach(function(n){0==f&&(f=e.rows,h++),f--,e.insertComponentAt(n,o+f*h)})}else if(u===n){e.components[i].colspan+=1;for(var m=0;m<e.rows;m++)s.push(w(e.components[n+e.columns*m].model,e.app));r.push(e.widths[n]);var d=e.columns,v=e.rows;s.reverse().forEach(function(n){0==v&&(v=e.rows,d++),v--,e.insertComponentAt(n,o+v*d)}),e.components[i+c+1].rowspan=1,e.components[i+c+1].colspan=1,e.components[i+c+1].merged=!0,e.components[i+c+1].set("text","")}else{e.components[i].colspan+=1;for(var y=0;y<e.rows;y++)s.push(w(e.components[n+e.columns*y].model,e.app));r.push(e.widths[n]);var C=e.columns,b=e.rows;s.reverse().forEach(function(n){0==b&&(b=e.rows,C++),b--,e.insertComponentAt(n,o+b*C)})}var x=e.widths.slice();e.model.columns+=t.length,x.splice.apply(x,[o,0].concat(r)),e.set("widths",x)})}})}},{key:"distributeHorizontal",value:function(n){var e=this,t=[];n.forEach(function(n){var o=e.getRowColumn(n);-1==t.indexOf(o.column)&&t.push(o.column)});var o=t.reduce(function(n,t){return n+e.widths[t]},0),r=Math.round(o/t.length*100)/100,s=this.widths.slice();t.forEach(function(n){s[n]=r}),this.set("widths",s)}},{key:"distributeVertical",value:function(n){var e=this,t=[];n.forEach(function(n){var o=e.getRowColumn(n);-1==t.indexOf(o.row)&&t.push(o.row)});var o=t.reduce(function(n,t){return n+e.heights[t]},0),r=Math.round(o/t.length*100)/100,s=this.heights.slice();t.forEach(function(n){s[n]=r}),this.set("heights",s)}},{key:"toObjectArrayValue",value:function(n){if(!n||0===n.length)return null;if(!n[0].hasOwnProperty("__field1"))return n;var e={},t=[];for(var o in n[0])e[o]=n[0][o];for(var r=1;r<n.length;r++){var s={},i=n[r];for(var c in e){var u=e[c],l=i[c];s[u]=l}t.push(s)}return t}},{key:"onchange",value:function(n,e){if("rows"in n||"columns"in n){var t=this.rows,o=this.columns;this.buildCells(t,o,"rows"in e?e.rows:t,"columns"in e?e.columns:o)}"data"in n&&this.setCellsData()}},{key:"oncellchanged",value:function(n,e){("dataKey"in n||"dataIndex"in n)&&this.setCellsData()}},{key:"focusible",get:function(){return!1}},{key:"widths",get:function(){var n=this.get("widths");return n?n.length<this.columns?n.concat(_(0,this.columns-n.length)):n.length>this.columns?n.slice(0,this.columns):n:_(0,this.columns)}},{key:"heights",get:function(){var n=this.get("heights");return n?n.length<this.rows?n.concat(_(0,this.rows-n.length)):n.length>this.rows?n.slice(0,this.rows):n:_(0,this.rows)}},{key:"layout",get:function(){return d}},{key:"rows",get:function(){return Number(this.get("rows"))}},{key:"columns",get:function(){return Number(this.get("columns"))}},{key:"lefts",get:function(){var n=this;return this.components.filter(function(e,t){return!(t%n.columns)})}},{key:"centers",get:function(){var n=this;return this.components.filter(function(e,t){return t%n.columns&&(t+1)%n.columns})}},{key:"rights",get:function(){var n=this;return this.components.filter(function(e,t){return!((t+1)%n.columns)})}},{key:"tops",get:function(){return this.components.slice(0,this.columns)}},{key:"middles",get:function(){return this.components.slice(this.columns,this.columns*(this.rows-1))}},{key:"bottoms",get:function(){return this.components.slice(this.columns*(this.rows-1))}},{key:"widths_sum",get:function(){var n=this,e=this.widths;return e?e.filter(function(e,t){return t<n.columns}).reduce(function(n,e){return n+e},0):this.columns}},{key:"heights_sum",get:function(){var n=this,e=this.heights;return e?e.filter(function(e,t){return t<n.rows}).reduce(function(n,e){return n+e},0):this.rows}},{key:"nature",get:function(){return h}},{key:"controls",get:function(){var n=this.widths,e=this.heights,t=this.textBounds,o=t.width/this.widths_sum,r=t.height/this.heights_sum,s=t.left,i=t.top,c=[];return n.slice(0,this.columns-1).forEach(function(n){s+=n*o,c.push({x:s,y:t.top,handler:B})}),e.slice(0,this.rows-1).forEach(function(n){i+=n*r,c.push({x:t.left,y:i,handler:A})}),c}},{key:"eventMap",get:function(){return{"(self)":{"(descendant)":{change:this.oncellchanged}}}}}]),t}();["rows","columns","widths","heights","widths_sum","heights_sum","controls"].forEach(function(n){return e.Component.memoize(j.prototype,n,!1)}),e.Component.register("table",j);var P={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"editor-table",label:"",name:"",property:{merge:!0,split:!0}},{type:"string",label:"data-key",name:"dataKey",property:"dataKey"},{type:"number",label:"data-index",name:"dataIndex",property:"dataIndex"}]};var S=function(n){function t(){return o(this,t),l(this,c(t).apply(this,arguments))}return i(t,e.RectPath(e.Component)),s(t,[{key:"_drawBorder",value:function(n,t,o,r,s,i){i&&i.strokeStyle&&i.lineWidth&&i.lineDash&&(n.beginPath(),n.moveTo(t,o),n.lineTo(r,s),e.Component.drawStroke(n,i))}},{key:"_draw",value:function(n){var e=this.model,t=e.left,o=e.top,r=e.width,s=e.height,i=this.model.border||{};n.beginPath(),n.lineWidth=0,n.rect(t,o,r,s),this.drawFill(n);var c=this.parent,u=c.components.indexOf(this),l=c.columns||1,a=c.rows||1;this._drawBorder(n,t,o,t+r,o,i.top),this._drawBorder(n,t,o+s,t,o,i.left),function(n,e,t){return(n+1)%t==0}(u,0,l)&&this._drawBorder(n,t+r,o,t+r,o+s,i.right),function(n,e,t){return n>=(e-1)*t}(u,a,l)&&this._drawBorder(n,t+r,o+s,t,o+s,i.bottom)}},{key:"nature",get:function(){return P}},{key:"merged",set:function(n){this.set("merged",!!n),n&&this.set("text","")},get:function(){return this.get("merged")}},{key:"rowspan",set:function(n){this.set("rowspan",n)},get:function(){return this.get("rowspan")}},{key:"colspan",set:function(n){this.set("colspan",n)},get:function(){return this.get("colspan")}},{key:"border",get:function(){this.model.border}}]),t}();function z(){var n=a(["\n        :host {\n          display: block;\n          overflow-x: none;\n          overflow-y: auto;\n        }\n\n        #grid {\n          display: grid;\n          grid-template-columns: repeat(2, 1fr);\n          border-top: 1px solid black;\n          border-right: 1px solid black;\n        }\n\n        span {\n          padding: 8px 4px;\n          border-left: 1px solid black;\n          border-bottom: 1px solid black;\n        }\n      "]);return z=function(){return n},n}function T(){var n=a(["\n      ","\n    "]);return T=function(){return n},n}function D(){var n=a(['\n      <div id="grid">\n        ',"\n      </div>\n    "]);return D=function(){return n},n}function N(){var n=a(["\n      ","\n    "]);return N=function(){return n},n}function W(){var n=a(["\n      <span>","</span>\n    "]);return W=function(){return n},n}["border"].forEach(function(n){return e.Component.memoize(S.prototype,n,!1)}),e.Component.register("table-cell",S);var I=function(n){function e(){var n;return o(this,e),(n=l(this,c(e).call(this))).data=[],n.format=[{height:100,fields:[{width:50,property:"aaa"},{width:50,property:"bbb"}]}],n}return i(e,t.LitElement),s(e,[{key:"updated",value:function(n){}},{key:"field",value:function(n,e){return console.log("record",e),t.html(W(),e[n.property])}},{key:"row",value:function(n,e){var o=this;return t.html(N(),n.fields.map(function(n){return o.field(n,e)}))}},{key:"record",value:function(n){var e=this;return t.html(D(),this.format.map(function(t){return e.row(t,n)}))}},{key:"render",value:function(){var n=this;return t.html(T(),this.data.map(function(e){return n.record(e)}))}}],[{key:"properties",get:function(){return{format:Array,data:Array}}},{key:"styles",get:function(){return[t.css(z())]}}]),e}();customElements.define("simple-grid-view",I);var K={mutable:!1,resizable:!0,rotatable:!0,properties:[],"value-property":"data"},L=function(n){function t(){return o(this,t),l(this,c(t).apply(this,arguments))}return i(t,e.HTMLOverlayContainer),s(t,[{key:"setElementProperties",value:function(n){n.data=this.data}},{key:"tagName",get:function(){return"simple-grid-view"}},{key:"nature",get:function(){return K}}]),t}();e.Component.register("simple-grid",L),n.Table=j,n.TableCell=S,n.Grid=L,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=things-scene-table.js.map
